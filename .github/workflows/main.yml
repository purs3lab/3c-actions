# This file is generated by generate-workflow.py. To update this file, update
# generate-workflow.py instead and re-run it. Some things in this file are
# explained by comments in generate-workflow.py.

name: 3C benchmark tests

on:
  # Run every day at the following time.
  schedule:
    - cron: "0 5 * * *"
  workflow_dispatch:
    inputs:
      branch:
        description: "Branch or commit ID of correctcomputation/checkedc-clang to run workflow on"
        required: true
        default: "main"

env:
  benchmark_tar_dir: "/home/github/checkedc-benchmarks"
  builddir: "${{github.workspace}}/b/ninja"
  benchmark_conv_dir: "${{github.workspace}}/benchmark_conv"
  branch_for_scheduled_run: "main"
  port_tools: "${{github.workspace}}/depsfolder/checkedc-clang/clang/tools/3c/utils/port_tools"

jobs:

  # Cleanup files left behind by prior runs
  clean:
    name: Clean
    runs-on: self-hosted
    steps:
      - name: Clean
        run: |
          rm -rf ${{env.benchmark_conv_dir}}
          mkdir -p ${{env.benchmark_conv_dir}}
          rm -rf ${{env.builddir}}
          mkdir -p ${{env.builddir}}
          rm -rf ${{github.workspace}}/depsfolder
          mkdir -p ${{github.workspace}}/depsfolder

  # Clone and build 3c and clang
  # (clang is needed to test compilation of converted benchmarks.)
  build_3c:
    name: Build 3c and clang
    needs: clean
    runs-on: self-hosted
    steps:
      - name: Check out the actions repository
        uses: actions/checkout@v2
        with:
          path: depsfolder/actions
      - name: Check that the workflow file is up to date with generate-workflow.py before running it
        run: |
          cd ${{github.workspace}}/depsfolder/actions
          ./generate-workflow.py
          git diff --exit-code

      - name: Branch or commit ID
        run: echo "${{ github.event.inputs.branch || env.branch_for_scheduled_run }}"
      - name: Check out the 3C repository and the Checked C system headers
        run: |
          git init ${{github.workspace}}/depsfolder/checkedc-clang
          cd ${{github.workspace}}/depsfolder/checkedc-clang
          git remote add origin https://github.com/correctcomputation/checkedc-clang
          git fetch --depth 1 origin "${{ github.event.inputs.branch || env.branch_for_scheduled_run }}"
          git checkout FETCH_HEAD
          # As of 2021-04-12, we're using CCI's `checkedc` repository because it
          # has a checked declaration for `syslog` that we want to use for our
          # experiments but have not yet submitted to Microsoft.
          git clone --depth 1 https://github.com/correctcomputation/checkedc ${{github.workspace}}/depsfolder/checkedc-clang/llvm/projects/checkedc-wrapper/checkedc

      - name: Build 3c and clang
        run: |
          cd ${{env.builddir}}
          # We'll be running the tools enough that it's worth spending the extra
          # time for an optimized build, and the easiest way to do that is to
          # use a "release" build. But we do want assertions and we do want
          # debug info in order to get symbols in assertion stack traces, so we
          # use -DLLVM_ENABLE_ASSERTIONS=ON and the RelWithDebInfo build type,
          # respectively. Furthermore, the tools rely on the llvm-symbolizer
          # helper program to actually read the debug info and generate the
          # symbolized stack trace when an assertion failure occurs. We could
          # build it here, but as of 2021-03-15, we just use Ubuntu's version
          # installed systemwide; it seems that llvm-symbolizer is a generic
          # tool and the difference in versions does not matter.
          cmake -G Ninja \
            -DLLVM_TARGETS_TO_BUILD=X86 \
            -DCMAKE_BUILD_TYPE="RelWithDebInfo" \
            -DLLVM_ENABLE_ASSERTIONS=ON \
            -DLLVM_OPTIMIZED_TABLEGEN=ON \
            -DLLVM_USE_SPLIT_DWARF=ON \
            -DLLVM_ENABLE_PROJECTS="clang" \
            ${{github.workspace}}/depsfolder/checkedc-clang/llvm
          ninja -l $(nproc) 3c clang clang-rename
          chmod -R 777 ${{github.workspace}}/depsfolder
          chmod -R 777 ${{env.builddir}}

  # Run Test for 3C
  test_3c:
    name: 3C regression tests
    needs: build_3c
    runs-on: self-hosted
    steps:
      - name: 3C regression tests
        run: |
          cd ${{env.builddir}}
          ninja -l $(nproc) check-3c

  # Convert our benchmark programs

  test_vsftpd_no_expand_macros_no_alltypes:
    name: Test Vsftpd (not macro-expanded, no -alltypes)
    needs: build_3c
    runs-on: self-hosted
    steps:
      - name: Build Vsftpd
        run: |
          mkdir -p ${{env.benchmark_conv_dir}}/no_expand_macros_no_alltypes
          cd ${{env.benchmark_conv_dir}}/no_expand_macros_no_alltypes
          tar -xvzf ${{env.benchmark_tar_dir}}/vsftpd-3.0.3.tar.gz
          cd vsftpd-3.0.3
          bear make -j $(nproc) -l $(nproc) --output-sync CC="${{env.builddir}}/bin/clang -w -ferror-limit=0 -Wno-enum-conversion"

      - name: Convert Vsftpd
        run: |
          cd ${{env.benchmark_conv_dir}}/no_expand_macros_no_alltypes/vsftpd-3.0.3
          ${{env.port_tools}}/convert_project.py \
            --prog_name ${{env.builddir}}/bin/3c \
            --project_path .

      - name: Build converted Vsftpd
        run: |
          cd ${{env.benchmark_conv_dir}}/no_expand_macros_no_alltypes/vsftpd-3.0.3
          if [ -e "out.checked" ]; then cp -r out.checked/* . && rm -r out.checked; fi
          make -j $(nproc) -l $(nproc) --output-sync CC="${{env.builddir}}/bin/clang -w -ferror-limit=0 -Wno-enum-conversion" -k

  test_vsftpd_no_expand_macros_alltypes:
    name: Test Vsftpd (not macro-expanded, -alltypes)
    needs: build_3c
    runs-on: self-hosted
    steps:
      - name: Build Vsftpd
        run: |
          mkdir -p ${{env.benchmark_conv_dir}}/no_expand_macros_alltypes
          cd ${{env.benchmark_conv_dir}}/no_expand_macros_alltypes
          tar -xvzf ${{env.benchmark_tar_dir}}/vsftpd-3.0.3.tar.gz
          cd vsftpd-3.0.3
          bear make -j $(nproc) -l $(nproc) --output-sync CC="${{env.builddir}}/bin/clang -w -ferror-limit=0 -Wno-enum-conversion"

      - name: Convert Vsftpd
        run: |
          cd ${{env.benchmark_conv_dir}}/no_expand_macros_alltypes/vsftpd-3.0.3
          ${{env.port_tools}}/convert_project.py \
            --prog_name ${{env.builddir}}/bin/3c \
            --extra-3c-arg=-alltypes \
            --project_path .

      - name: Build converted Vsftpd (filter bounds inference errors)
        run: |
          cd ${{env.benchmark_conv_dir}}/no_expand_macros_alltypes/vsftpd-3.0.3
          if [ -e "out.checked" ]; then cp -r out.checked/* . && rm -r out.checked; fi
          make -j $(nproc) -l $(nproc) --output-sync CC="${{env.builddir}}/bin/clang -w -ferror-limit=0 -Wno-enum-conversion" -k 2>&1 | ${{github.workspace}}/depsfolder/actions/filter-bounds-inference-errors.py

  test_vsftpd_expand_macros_no_alltypes:
    name: Test Vsftpd (macro-expanded, no -alltypes)
    needs: build_3c
    runs-on: self-hosted
    steps:
      - name: Build Vsftpd
        run: |
          mkdir -p ${{env.benchmark_conv_dir}}/expand_macros_no_alltypes
          cd ${{env.benchmark_conv_dir}}/expand_macros_no_alltypes
          tar -xvzf ${{env.benchmark_tar_dir}}/vsftpd-3.0.3.tar.gz
          cd vsftpd-3.0.3
          bear make -j $(nproc) -l $(nproc) --output-sync CC="${{env.builddir}}/bin/clang -w -ferror-limit=0 -Wno-enum-conversion"

      - name: Convert Vsftpd
        run: |
          cd ${{env.benchmark_conv_dir}}/expand_macros_no_alltypes/vsftpd-3.0.3
          ${{env.port_tools}}/convert_project.py \
            --prog_name ${{env.builddir}}/bin/3c \
            --expand_macros_before_conversion \
            --project_path .

      - name: Build converted Vsftpd
        run: |
          cd ${{env.benchmark_conv_dir}}/expand_macros_no_alltypes/vsftpd-3.0.3
          if [ -e "out.checked" ]; then cp -r out.checked/* . && rm -r out.checked; fi
          make -j $(nproc) -l $(nproc) --output-sync CC="${{env.builddir}}/bin/clang -w -ferror-limit=0 -Wno-enum-conversion" -k

  test_vsftpd_expand_macros_alltypes:
    name: Test Vsftpd (macro-expanded, -alltypes)
    needs: build_3c
    runs-on: self-hosted
    steps:
      - name: Build Vsftpd
        run: |
          mkdir -p ${{env.benchmark_conv_dir}}/expand_macros_alltypes
          cd ${{env.benchmark_conv_dir}}/expand_macros_alltypes
          tar -xvzf ${{env.benchmark_tar_dir}}/vsftpd-3.0.3.tar.gz
          cd vsftpd-3.0.3
          bear make -j $(nproc) -l $(nproc) --output-sync CC="${{env.builddir}}/bin/clang -w -ferror-limit=0 -Wno-enum-conversion"

      - name: Convert Vsftpd
        run: |
          cd ${{env.benchmark_conv_dir}}/expand_macros_alltypes/vsftpd-3.0.3
          ${{env.port_tools}}/convert_project.py \
            --prog_name ${{env.builddir}}/bin/3c \
            --extra-3c-arg=-alltypes \
            --expand_macros_before_conversion \
            --project_path .

      - name: Build converted Vsftpd (filter bounds inference errors)
        run: |
          cd ${{env.benchmark_conv_dir}}/expand_macros_alltypes/vsftpd-3.0.3
          if [ -e "out.checked" ]; then cp -r out.checked/* . && rm -r out.checked; fi
          make -j $(nproc) -l $(nproc) --output-sync CC="${{env.builddir}}/bin/clang -w -ferror-limit=0 -Wno-enum-conversion" -k 2>&1 | ${{github.workspace}}/depsfolder/actions/filter-bounds-inference-errors.py

  test_Parson_no_expand_macros_no_alltypes:
    name: Test Parson (not macro-expanded, no -alltypes)
    needs: build_3c
    runs-on: self-hosted
    steps:
      - name: Build Parson
        run: |
          mkdir -p ${{env.benchmark_conv_dir}}/no_expand_macros_no_alltypes
          cd ${{env.benchmark_conv_dir}}/no_expand_macros_no_alltypes
          tar -xvzf ${{env.benchmark_tar_dir}}/parson.tar.gz
          cd parson
          bear make -j $(nproc) -l $(nproc) --output-sync CC="${{env.builddir}}/bin/clang"

      - name: Convert Parson
        run: |
          cd ${{env.benchmark_conv_dir}}/no_expand_macros_no_alltypes/parson
          ${{env.port_tools}}/convert_project.py \
            --prog_name ${{env.builddir}}/bin/3c \
            --project_path .

      - name: Build converted Parson
        run: |
          cd ${{env.benchmark_conv_dir}}/no_expand_macros_no_alltypes/parson
          if [ -e "out.checked" ]; then cp -r out.checked/* . && rm -r out.checked; fi
          make -j $(nproc) -l $(nproc) --output-sync CC="${{env.builddir}}/bin/clang" -k

  test_Parson_no_expand_macros_alltypes:
    name: Test Parson (not macro-expanded, -alltypes)
    needs: build_3c
    runs-on: self-hosted
    steps:
      - name: Build Parson
        run: |
          mkdir -p ${{env.benchmark_conv_dir}}/no_expand_macros_alltypes
          cd ${{env.benchmark_conv_dir}}/no_expand_macros_alltypes
          tar -xvzf ${{env.benchmark_tar_dir}}/parson.tar.gz
          cd parson
          bear make -j $(nproc) -l $(nproc) --output-sync CC="${{env.builddir}}/bin/clang"

      - name: Convert Parson
        run: |
          cd ${{env.benchmark_conv_dir}}/no_expand_macros_alltypes/parson
          ${{env.port_tools}}/convert_project.py \
            --prog_name ${{env.builddir}}/bin/3c \
            --extra-3c-arg=-alltypes \
            --project_path .

      - name: Build converted Parson (filter bounds inference errors)
        run: |
          cd ${{env.benchmark_conv_dir}}/no_expand_macros_alltypes/parson
          if [ -e "out.checked" ]; then cp -r out.checked/* . && rm -r out.checked; fi
          make -j $(nproc) -l $(nproc) --output-sync CC="${{env.builddir}}/bin/clang" -k 2>&1 | ${{github.workspace}}/depsfolder/actions/filter-bounds-inference-errors.py

  test_Parson_expand_macros_no_alltypes:
    name: Test Parson (macro-expanded, no -alltypes)
    needs: build_3c
    runs-on: self-hosted
    steps:
      - name: Build Parson
        run: |
          mkdir -p ${{env.benchmark_conv_dir}}/expand_macros_no_alltypes
          cd ${{env.benchmark_conv_dir}}/expand_macros_no_alltypes
          tar -xvzf ${{env.benchmark_tar_dir}}/parson.tar.gz
          cd parson
          bear make -j $(nproc) -l $(nproc) --output-sync CC="${{env.builddir}}/bin/clang"

      - name: Convert Parson
        run: |
          cd ${{env.benchmark_conv_dir}}/expand_macros_no_alltypes/parson
          ${{env.port_tools}}/convert_project.py \
            --prog_name ${{env.builddir}}/bin/3c \
            --expand_macros_before_conversion \
            --project_path .

      - name: Build converted Parson
        run: |
          cd ${{env.benchmark_conv_dir}}/expand_macros_no_alltypes/parson
          if [ -e "out.checked" ]; then cp -r out.checked/* . && rm -r out.checked; fi
          make -j $(nproc) -l $(nproc) --output-sync CC="${{env.builddir}}/bin/clang" -k

  test_Parson_expand_macros_alltypes:
    name: Test Parson (macro-expanded, -alltypes)
    needs: build_3c
    runs-on: self-hosted
    steps:
      - name: Build Parson
        run: |
          mkdir -p ${{env.benchmark_conv_dir}}/expand_macros_alltypes
          cd ${{env.benchmark_conv_dir}}/expand_macros_alltypes
          tar -xvzf ${{env.benchmark_tar_dir}}/parson.tar.gz
          cd parson
          bear make -j $(nproc) -l $(nproc) --output-sync CC="${{env.builddir}}/bin/clang"

      - name: Convert Parson
        run: |
          cd ${{env.benchmark_conv_dir}}/expand_macros_alltypes/parson
          ${{env.port_tools}}/convert_project.py \
            --prog_name ${{env.builddir}}/bin/3c \
            --extra-3c-arg=-alltypes \
            --expand_macros_before_conversion \
            --project_path .

      - name: Build converted Parson (filter bounds inference errors)
        run: |
          cd ${{env.benchmark_conv_dir}}/expand_macros_alltypes/parson
          if [ -e "out.checked" ]; then cp -r out.checked/* . && rm -r out.checked; fi
          make -j $(nproc) -l $(nproc) --output-sync CC="${{env.builddir}}/bin/clang" -k 2>&1 | ${{github.workspace}}/depsfolder/actions/filter-bounds-inference-errors.py

  test_TinyBigNum_no_expand_macros_no_alltypes:
    name: Test TinyBigNum (not macro-expanded, no -alltypes)
    needs: build_3c
    runs-on: self-hosted
    steps:
      - name: Build TinyBigNum
        run: |
          mkdir -p ${{env.benchmark_conv_dir}}/no_expand_macros_no_alltypes
          cd ${{env.benchmark_conv_dir}}/no_expand_macros_no_alltypes
          tar -xvzf ${{env.benchmark_tar_dir}}/tiny-bignum-c.tar.gz
          cd tiny-bignum-c
          bear make -j $(nproc) -l $(nproc) --output-sync CC="${{env.builddir}}/bin/clang"

      - name: Convert TinyBigNum
        run: |
          cd ${{env.benchmark_conv_dir}}/no_expand_macros_no_alltypes/tiny-bignum-c
          ${{env.port_tools}}/convert_project.py \
            --prog_name ${{env.builddir}}/bin/3c \
            --project_path .

      - name: Build converted TinyBigNum
        run: |
          cd ${{env.benchmark_conv_dir}}/no_expand_macros_no_alltypes/tiny-bignum-c
          if [ -e "out.checked" ]; then cp -r out.checked/* . && rm -r out.checked; fi
          make -j $(nproc) -l $(nproc) --output-sync CC="${{env.builddir}}/bin/clang" -k

  test_TinyBigNum_no_expand_macros_alltypes:
    name: Test TinyBigNum (not macro-expanded, -alltypes)
    needs: build_3c
    runs-on: self-hosted
    steps:
      - name: Build TinyBigNum
        run: |
          mkdir -p ${{env.benchmark_conv_dir}}/no_expand_macros_alltypes
          cd ${{env.benchmark_conv_dir}}/no_expand_macros_alltypes
          tar -xvzf ${{env.benchmark_tar_dir}}/tiny-bignum-c.tar.gz
          cd tiny-bignum-c
          bear make -j $(nproc) -l $(nproc) --output-sync CC="${{env.builddir}}/bin/clang"

      - name: Convert TinyBigNum
        run: |
          cd ${{env.benchmark_conv_dir}}/no_expand_macros_alltypes/tiny-bignum-c
          ${{env.port_tools}}/convert_project.py \
            --prog_name ${{env.builddir}}/bin/3c \
            --extra-3c-arg=-alltypes \
            --project_path .

      - name: Build converted TinyBigNum (filter bounds inference errors)
        run: |
          cd ${{env.benchmark_conv_dir}}/no_expand_macros_alltypes/tiny-bignum-c
          if [ -e "out.checked" ]; then cp -r out.checked/* . && rm -r out.checked; fi
          make -j $(nproc) -l $(nproc) --output-sync CC="${{env.builddir}}/bin/clang" -k 2>&1 | ${{github.workspace}}/depsfolder/actions/filter-bounds-inference-errors.py

  test_TinyBigNum_expand_macros_no_alltypes:
    name: Test TinyBigNum (macro-expanded, no -alltypes)
    needs: build_3c
    runs-on: self-hosted
    steps:
      - name: Build TinyBigNum
        run: |
          mkdir -p ${{env.benchmark_conv_dir}}/expand_macros_no_alltypes
          cd ${{env.benchmark_conv_dir}}/expand_macros_no_alltypes
          tar -xvzf ${{env.benchmark_tar_dir}}/tiny-bignum-c.tar.gz
          cd tiny-bignum-c
          bear make -j $(nproc) -l $(nproc) --output-sync CC="${{env.builddir}}/bin/clang"

      - name: Convert TinyBigNum
        run: |
          cd ${{env.benchmark_conv_dir}}/expand_macros_no_alltypes/tiny-bignum-c
          ${{env.port_tools}}/convert_project.py \
            --prog_name ${{env.builddir}}/bin/3c \
            --expand_macros_before_conversion \
            --project_path .

      - name: Build converted TinyBigNum
        run: |
          cd ${{env.benchmark_conv_dir}}/expand_macros_no_alltypes/tiny-bignum-c
          if [ -e "out.checked" ]; then cp -r out.checked/* . && rm -r out.checked; fi
          make -j $(nproc) -l $(nproc) --output-sync CC="${{env.builddir}}/bin/clang" -k

  test_TinyBigNum_expand_macros_alltypes:
    name: Test TinyBigNum (macro-expanded, -alltypes)
    needs: build_3c
    runs-on: self-hosted
    steps:
      - name: Build TinyBigNum
        run: |
          mkdir -p ${{env.benchmark_conv_dir}}/expand_macros_alltypes
          cd ${{env.benchmark_conv_dir}}/expand_macros_alltypes
          tar -xvzf ${{env.benchmark_tar_dir}}/tiny-bignum-c.tar.gz
          cd tiny-bignum-c
          bear make -j $(nproc) -l $(nproc) --output-sync CC="${{env.builddir}}/bin/clang"

      - name: Convert TinyBigNum
        run: |
          cd ${{env.benchmark_conv_dir}}/expand_macros_alltypes/tiny-bignum-c
          ${{env.port_tools}}/convert_project.py \
            --prog_name ${{env.builddir}}/bin/3c \
            --extra-3c-arg=-alltypes \
            --expand_macros_before_conversion \
            --project_path .

      - name: Build converted TinyBigNum (filter bounds inference errors)
        run: |
          cd ${{env.benchmark_conv_dir}}/expand_macros_alltypes/tiny-bignum-c
          if [ -e "out.checked" ]; then cp -r out.checked/* . && rm -r out.checked; fi
          make -j $(nproc) -l $(nproc) --output-sync CC="${{env.builddir}}/bin/clang" -k 2>&1 | ${{github.workspace}}/depsfolder/actions/filter-bounds-inference-errors.py

  test_Olden_no_expand_macros_no_alltypes:
    name: Test Olden (not macro-expanded, no -alltypes)
    needs: build_3c
    runs-on: self-hosted
    steps:
      - name: Build Olden
        run: |
          mkdir -p ${{env.benchmark_conv_dir}}/no_expand_macros_no_alltypes
          cd ${{env.benchmark_conv_dir}}/no_expand_macros_no_alltypes
          tar -xvzf ${{env.benchmark_tar_dir}}/Olden.tar.gz
          cd Olden
          for i in bh bisort em3d health mst perimeter power treeadd tsp voronoi ; do \
            (cd $i ; bear make -j $(nproc) -l $(nproc) --output-sync CC="${{env.builddir}}/bin/clang" LOCAL_CFLAGS="-w -ferror-limit=0 -D_ISOC99_SOURCE") \
          done

      - name: Convert bh
        run: |
          cd ${{env.benchmark_conv_dir}}/no_expand_macros_no_alltypes/Olden/bh
          ${{env.port_tools}}/convert_project.py \
            --extra-3c-arg=-allow-unwritable-changes \
            --prog_name ${{env.builddir}}/bin/3c \
            --project_path .

      - name: Build converted bh (defer failure)
        run: |
          cd ${{env.benchmark_conv_dir}}/no_expand_macros_no_alltypes/Olden/bh
          if [ -e "out.checked" ]; then cp -r out.checked/* . && rm -r out.checked; fi
          make -j $(nproc) -l $(nproc) --output-sync CC="${{env.builddir}}/bin/clang" -k LOCAL_CFLAGS="-w -ferror-limit=0 -D_ISOC99_SOURCE" || echo bh >>${{env.benchmark_conv_dir}}/no_expand_macros_no_alltypes/Olden/failed-components-list.txt

      - name: Convert bisort
        run: |
          cd ${{env.benchmark_conv_dir}}/no_expand_macros_no_alltypes/Olden/bisort
          ${{env.port_tools}}/convert_project.py \
            --extra-3c-arg=-allow-unwritable-changes \
            --prog_name ${{env.builddir}}/bin/3c \
            --project_path .

      - name: Build converted bisort (defer failure)
        run: |
          cd ${{env.benchmark_conv_dir}}/no_expand_macros_no_alltypes/Olden/bisort
          if [ -e "out.checked" ]; then cp -r out.checked/* . && rm -r out.checked; fi
          make -j $(nproc) -l $(nproc) --output-sync CC="${{env.builddir}}/bin/clang" -k LOCAL_CFLAGS="-w -ferror-limit=0 -D_ISOC99_SOURCE" || echo bisort >>${{env.benchmark_conv_dir}}/no_expand_macros_no_alltypes/Olden/failed-components-list.txt

      - name: Convert em3d
        run: |
          cd ${{env.benchmark_conv_dir}}/no_expand_macros_no_alltypes/Olden/em3d
          ${{env.port_tools}}/convert_project.py \
            --extra-3c-arg=-allow-unwritable-changes \
            --prog_name ${{env.builddir}}/bin/3c \
            --project_path .

      - name: Build converted em3d (defer failure)
        run: |
          cd ${{env.benchmark_conv_dir}}/no_expand_macros_no_alltypes/Olden/em3d
          if [ -e "out.checked" ]; then cp -r out.checked/* . && rm -r out.checked; fi
          make -j $(nproc) -l $(nproc) --output-sync CC="${{env.builddir}}/bin/clang" -k LOCAL_CFLAGS="-w -ferror-limit=0 -D_ISOC99_SOURCE" || echo em3d >>${{env.benchmark_conv_dir}}/no_expand_macros_no_alltypes/Olden/failed-components-list.txt

      - name: Convert health
        run: |
          cd ${{env.benchmark_conv_dir}}/no_expand_macros_no_alltypes/Olden/health
          ${{env.port_tools}}/convert_project.py \
            --extra-3c-arg=-allow-unwritable-changes \
            --prog_name ${{env.builddir}}/bin/3c \
            --project_path .

      - name: Build converted health (defer failure)
        run: |
          cd ${{env.benchmark_conv_dir}}/no_expand_macros_no_alltypes/Olden/health
          if [ -e "out.checked" ]; then cp -r out.checked/* . && rm -r out.checked; fi
          make -j $(nproc) -l $(nproc) --output-sync CC="${{env.builddir}}/bin/clang" -k LOCAL_CFLAGS="-w -ferror-limit=0 -D_ISOC99_SOURCE" || echo health >>${{env.benchmark_conv_dir}}/no_expand_macros_no_alltypes/Olden/failed-components-list.txt

      - name: Convert mst
        run: |
          cd ${{env.benchmark_conv_dir}}/no_expand_macros_no_alltypes/Olden/mst
          ${{env.port_tools}}/convert_project.py \
            --extra-3c-arg=-allow-unwritable-changes \
            --prog_name ${{env.builddir}}/bin/3c \
            --project_path .

      - name: Build converted mst (defer failure)
        run: |
          cd ${{env.benchmark_conv_dir}}/no_expand_macros_no_alltypes/Olden/mst
          if [ -e "out.checked" ]; then cp -r out.checked/* . && rm -r out.checked; fi
          make -j $(nproc) -l $(nproc) --output-sync CC="${{env.builddir}}/bin/clang" -k LOCAL_CFLAGS="-w -ferror-limit=0 -D_ISOC99_SOURCE" || echo mst >>${{env.benchmark_conv_dir}}/no_expand_macros_no_alltypes/Olden/failed-components-list.txt

      - name: Convert perimeter
        run: |
          cd ${{env.benchmark_conv_dir}}/no_expand_macros_no_alltypes/Olden/perimeter
          ${{env.port_tools}}/convert_project.py \
            --extra-3c-arg=-allow-unwritable-changes \
            --prog_name ${{env.builddir}}/bin/3c \
            --project_path .

      - name: Build converted perimeter (defer failure)
        run: |
          cd ${{env.benchmark_conv_dir}}/no_expand_macros_no_alltypes/Olden/perimeter
          if [ -e "out.checked" ]; then cp -r out.checked/* . && rm -r out.checked; fi
          make -j $(nproc) -l $(nproc) --output-sync CC="${{env.builddir}}/bin/clang" -k LOCAL_CFLAGS="-w -ferror-limit=0 -D_ISOC99_SOURCE" || echo perimeter >>${{env.benchmark_conv_dir}}/no_expand_macros_no_alltypes/Olden/failed-components-list.txt

      - name: Convert power
        run: |
          cd ${{env.benchmark_conv_dir}}/no_expand_macros_no_alltypes/Olden/power
          ${{env.port_tools}}/convert_project.py \
            --extra-3c-arg=-allow-unwritable-changes \
            --prog_name ${{env.builddir}}/bin/3c \
            --project_path .

      - name: Build converted power (defer failure)
        run: |
          cd ${{env.benchmark_conv_dir}}/no_expand_macros_no_alltypes/Olden/power
          if [ -e "out.checked" ]; then cp -r out.checked/* . && rm -r out.checked; fi
          make -j $(nproc) -l $(nproc) --output-sync CC="${{env.builddir}}/bin/clang" -k LOCAL_CFLAGS="-w -ferror-limit=0 -D_ISOC99_SOURCE" || echo power >>${{env.benchmark_conv_dir}}/no_expand_macros_no_alltypes/Olden/failed-components-list.txt

      - name: Convert treeadd
        run: |
          cd ${{env.benchmark_conv_dir}}/no_expand_macros_no_alltypes/Olden/treeadd
          ${{env.port_tools}}/convert_project.py \
            --extra-3c-arg=-allow-unwritable-changes \
            --prog_name ${{env.builddir}}/bin/3c \
            --project_path .

      - name: Build converted treeadd (defer failure)
        run: |
          cd ${{env.benchmark_conv_dir}}/no_expand_macros_no_alltypes/Olden/treeadd
          if [ -e "out.checked" ]; then cp -r out.checked/* . && rm -r out.checked; fi
          make -j $(nproc) -l $(nproc) --output-sync CC="${{env.builddir}}/bin/clang" -k LOCAL_CFLAGS="-w -ferror-limit=0 -D_ISOC99_SOURCE" || echo treeadd >>${{env.benchmark_conv_dir}}/no_expand_macros_no_alltypes/Olden/failed-components-list.txt

      - name: Convert tsp
        run: |
          cd ${{env.benchmark_conv_dir}}/no_expand_macros_no_alltypes/Olden/tsp
          ${{env.port_tools}}/convert_project.py \
            --extra-3c-arg=-allow-unwritable-changes \
            --prog_name ${{env.builddir}}/bin/3c \
            --project_path .

      - name: Build converted tsp (defer failure)
        run: |
          cd ${{env.benchmark_conv_dir}}/no_expand_macros_no_alltypes/Olden/tsp
          if [ -e "out.checked" ]; then cp -r out.checked/* . && rm -r out.checked; fi
          make -j $(nproc) -l $(nproc) --output-sync CC="${{env.builddir}}/bin/clang" -k LOCAL_CFLAGS="-w -ferror-limit=0 -D_ISOC99_SOURCE" || echo tsp >>${{env.benchmark_conv_dir}}/no_expand_macros_no_alltypes/Olden/failed-components-list.txt

      - name: Convert voronoi
        run: |
          cd ${{env.benchmark_conv_dir}}/no_expand_macros_no_alltypes/Olden/voronoi
          ${{env.port_tools}}/convert_project.py \
            --extra-3c-arg=-allow-unwritable-changes \
            --prog_name ${{env.builddir}}/bin/3c \
            --project_path .

      - name: Build converted voronoi (defer failure)
        run: |
          cd ${{env.benchmark_conv_dir}}/no_expand_macros_no_alltypes/Olden/voronoi
          if [ -e "out.checked" ]; then cp -r out.checked/* . && rm -r out.checked; fi
          make -j $(nproc) -l $(nproc) --output-sync CC="${{env.builddir}}/bin/clang" -k LOCAL_CFLAGS="-w -ferror-limit=0 -D_ISOC99_SOURCE" || echo voronoi >>${{env.benchmark_conv_dir}}/no_expand_macros_no_alltypes/Olden/failed-components-list.txt

      - name: Check for deferred post-conversion build failures
        run: |
          if [ -e ${{env.benchmark_conv_dir}}/no_expand_macros_no_alltypes/Olden/failed-components-list.txt ]; then
              echo 'Failed components (see previous post-conversion build steps):'
              cat ${{env.benchmark_conv_dir}}/no_expand_macros_no_alltypes/Olden/failed-components-list.txt
              exit 1
          fi

  test_Olden_no_expand_macros_alltypes:
    name: Test Olden (not macro-expanded, -alltypes)
    needs: build_3c
    runs-on: self-hosted
    steps:
      - name: Build Olden
        run: |
          mkdir -p ${{env.benchmark_conv_dir}}/no_expand_macros_alltypes
          cd ${{env.benchmark_conv_dir}}/no_expand_macros_alltypes
          tar -xvzf ${{env.benchmark_tar_dir}}/Olden.tar.gz
          cd Olden
          for i in bh bisort em3d health mst perimeter power treeadd tsp voronoi ; do \
            (cd $i ; bear make -j $(nproc) -l $(nproc) --output-sync CC="${{env.builddir}}/bin/clang" LOCAL_CFLAGS="-w -ferror-limit=0 -D_ISOC99_SOURCE") \
          done

      - name: Convert bh
        run: |
          cd ${{env.benchmark_conv_dir}}/no_expand_macros_alltypes/Olden/bh
          ${{env.port_tools}}/convert_project.py \
            --extra-3c-arg=-allow-unwritable-changes \
            --prog_name ${{env.builddir}}/bin/3c \
            --extra-3c-arg=-alltypes \
            --project_path .

      - name: Build converted bh (filter bounds inference errors) (defer failure)
        run: |
          cd ${{env.benchmark_conv_dir}}/no_expand_macros_alltypes/Olden/bh
          if [ -e "out.checked" ]; then cp -r out.checked/* . && rm -r out.checked; fi
          make -j $(nproc) -l $(nproc) --output-sync CC="${{env.builddir}}/bin/clang" -k LOCAL_CFLAGS="-w -ferror-limit=0 -D_ISOC99_SOURCE" 2>&1 | ${{github.workspace}}/depsfolder/actions/filter-bounds-inference-errors.py || echo bh >>${{env.benchmark_conv_dir}}/no_expand_macros_alltypes/Olden/failed-components-list.txt

      - name: Convert bisort
        run: |
          cd ${{env.benchmark_conv_dir}}/no_expand_macros_alltypes/Olden/bisort
          ${{env.port_tools}}/convert_project.py \
            --extra-3c-arg=-allow-unwritable-changes \
            --prog_name ${{env.builddir}}/bin/3c \
            --extra-3c-arg=-alltypes \
            --project_path .

      - name: Build converted bisort (filter bounds inference errors) (defer failure)
        run: |
          cd ${{env.benchmark_conv_dir}}/no_expand_macros_alltypes/Olden/bisort
          if [ -e "out.checked" ]; then cp -r out.checked/* . && rm -r out.checked; fi
          make -j $(nproc) -l $(nproc) --output-sync CC="${{env.builddir}}/bin/clang" -k LOCAL_CFLAGS="-w -ferror-limit=0 -D_ISOC99_SOURCE" 2>&1 | ${{github.workspace}}/depsfolder/actions/filter-bounds-inference-errors.py || echo bisort >>${{env.benchmark_conv_dir}}/no_expand_macros_alltypes/Olden/failed-components-list.txt

      - name: Convert em3d
        run: |
          cd ${{env.benchmark_conv_dir}}/no_expand_macros_alltypes/Olden/em3d
          ${{env.port_tools}}/convert_project.py \
            --extra-3c-arg=-allow-unwritable-changes \
            --prog_name ${{env.builddir}}/bin/3c \
            --extra-3c-arg=-alltypes \
            --project_path .

      - name: Build converted em3d (filter bounds inference errors) (defer failure)
        run: |
          cd ${{env.benchmark_conv_dir}}/no_expand_macros_alltypes/Olden/em3d
          if [ -e "out.checked" ]; then cp -r out.checked/* . && rm -r out.checked; fi
          make -j $(nproc) -l $(nproc) --output-sync CC="${{env.builddir}}/bin/clang" -k LOCAL_CFLAGS="-w -ferror-limit=0 -D_ISOC99_SOURCE" 2>&1 | ${{github.workspace}}/depsfolder/actions/filter-bounds-inference-errors.py || echo em3d >>${{env.benchmark_conv_dir}}/no_expand_macros_alltypes/Olden/failed-components-list.txt

      - name: Convert health
        run: |
          cd ${{env.benchmark_conv_dir}}/no_expand_macros_alltypes/Olden/health
          ${{env.port_tools}}/convert_project.py \
            --extra-3c-arg=-allow-unwritable-changes \
            --prog_name ${{env.builddir}}/bin/3c \
            --extra-3c-arg=-alltypes \
            --project_path .

      - name: Build converted health (filter bounds inference errors) (defer failure)
        run: |
          cd ${{env.benchmark_conv_dir}}/no_expand_macros_alltypes/Olden/health
          if [ -e "out.checked" ]; then cp -r out.checked/* . && rm -r out.checked; fi
          make -j $(nproc) -l $(nproc) --output-sync CC="${{env.builddir}}/bin/clang" -k LOCAL_CFLAGS="-w -ferror-limit=0 -D_ISOC99_SOURCE" 2>&1 | ${{github.workspace}}/depsfolder/actions/filter-bounds-inference-errors.py || echo health >>${{env.benchmark_conv_dir}}/no_expand_macros_alltypes/Olden/failed-components-list.txt

      - name: Convert mst
        run: |
          cd ${{env.benchmark_conv_dir}}/no_expand_macros_alltypes/Olden/mst
          ${{env.port_tools}}/convert_project.py \
            --extra-3c-arg=-allow-unwritable-changes \
            --prog_name ${{env.builddir}}/bin/3c \
            --extra-3c-arg=-alltypes \
            --project_path .

      - name: Build converted mst (filter bounds inference errors) (defer failure)
        run: |
          cd ${{env.benchmark_conv_dir}}/no_expand_macros_alltypes/Olden/mst
          if [ -e "out.checked" ]; then cp -r out.checked/* . && rm -r out.checked; fi
          make -j $(nproc) -l $(nproc) --output-sync CC="${{env.builddir}}/bin/clang" -k LOCAL_CFLAGS="-w -ferror-limit=0 -D_ISOC99_SOURCE" 2>&1 | ${{github.workspace}}/depsfolder/actions/filter-bounds-inference-errors.py || echo mst >>${{env.benchmark_conv_dir}}/no_expand_macros_alltypes/Olden/failed-components-list.txt

      - name: Convert perimeter
        run: |
          cd ${{env.benchmark_conv_dir}}/no_expand_macros_alltypes/Olden/perimeter
          ${{env.port_tools}}/convert_project.py \
            --extra-3c-arg=-allow-unwritable-changes \
            --prog_name ${{env.builddir}}/bin/3c \
            --extra-3c-arg=-alltypes \
            --project_path .

      - name: Build converted perimeter (filter bounds inference errors) (defer failure)
        run: |
          cd ${{env.benchmark_conv_dir}}/no_expand_macros_alltypes/Olden/perimeter
          if [ -e "out.checked" ]; then cp -r out.checked/* . && rm -r out.checked; fi
          make -j $(nproc) -l $(nproc) --output-sync CC="${{env.builddir}}/bin/clang" -k LOCAL_CFLAGS="-w -ferror-limit=0 -D_ISOC99_SOURCE" 2>&1 | ${{github.workspace}}/depsfolder/actions/filter-bounds-inference-errors.py || echo perimeter >>${{env.benchmark_conv_dir}}/no_expand_macros_alltypes/Olden/failed-components-list.txt

      - name: Convert power
        run: |
          cd ${{env.benchmark_conv_dir}}/no_expand_macros_alltypes/Olden/power
          ${{env.port_tools}}/convert_project.py \
            --extra-3c-arg=-allow-unwritable-changes \
            --prog_name ${{env.builddir}}/bin/3c \
            --extra-3c-arg=-alltypes \
            --project_path .

      - name: Build converted power (filter bounds inference errors) (defer failure)
        run: |
          cd ${{env.benchmark_conv_dir}}/no_expand_macros_alltypes/Olden/power
          if [ -e "out.checked" ]; then cp -r out.checked/* . && rm -r out.checked; fi
          make -j $(nproc) -l $(nproc) --output-sync CC="${{env.builddir}}/bin/clang" -k LOCAL_CFLAGS="-w -ferror-limit=0 -D_ISOC99_SOURCE" 2>&1 | ${{github.workspace}}/depsfolder/actions/filter-bounds-inference-errors.py || echo power >>${{env.benchmark_conv_dir}}/no_expand_macros_alltypes/Olden/failed-components-list.txt

      - name: Convert treeadd
        run: |
          cd ${{env.benchmark_conv_dir}}/no_expand_macros_alltypes/Olden/treeadd
          ${{env.port_tools}}/convert_project.py \
            --extra-3c-arg=-allow-unwritable-changes \
            --prog_name ${{env.builddir}}/bin/3c \
            --extra-3c-arg=-alltypes \
            --project_path .

      - name: Build converted treeadd (filter bounds inference errors) (defer failure)
        run: |
          cd ${{env.benchmark_conv_dir}}/no_expand_macros_alltypes/Olden/treeadd
          if [ -e "out.checked" ]; then cp -r out.checked/* . && rm -r out.checked; fi
          make -j $(nproc) -l $(nproc) --output-sync CC="${{env.builddir}}/bin/clang" -k LOCAL_CFLAGS="-w -ferror-limit=0 -D_ISOC99_SOURCE" 2>&1 | ${{github.workspace}}/depsfolder/actions/filter-bounds-inference-errors.py || echo treeadd >>${{env.benchmark_conv_dir}}/no_expand_macros_alltypes/Olden/failed-components-list.txt

      - name: Convert tsp
        run: |
          cd ${{env.benchmark_conv_dir}}/no_expand_macros_alltypes/Olden/tsp
          ${{env.port_tools}}/convert_project.py \
            --extra-3c-arg=-allow-unwritable-changes \
            --prog_name ${{env.builddir}}/bin/3c \
            --extra-3c-arg=-alltypes \
            --project_path .

      - name: Build converted tsp (filter bounds inference errors) (defer failure)
        run: |
          cd ${{env.benchmark_conv_dir}}/no_expand_macros_alltypes/Olden/tsp
          if [ -e "out.checked" ]; then cp -r out.checked/* . && rm -r out.checked; fi
          make -j $(nproc) -l $(nproc) --output-sync CC="${{env.builddir}}/bin/clang" -k LOCAL_CFLAGS="-w -ferror-limit=0 -D_ISOC99_SOURCE" 2>&1 | ${{github.workspace}}/depsfolder/actions/filter-bounds-inference-errors.py || echo tsp >>${{env.benchmark_conv_dir}}/no_expand_macros_alltypes/Olden/failed-components-list.txt

      - name: Convert voronoi
        run: |
          cd ${{env.benchmark_conv_dir}}/no_expand_macros_alltypes/Olden/voronoi
          ${{env.port_tools}}/convert_project.py \
            --extra-3c-arg=-allow-unwritable-changes \
            --prog_name ${{env.builddir}}/bin/3c \
            --extra-3c-arg=-alltypes \
            --project_path .

      - name: Build converted voronoi (filter bounds inference errors) (defer failure)
        run: |
          cd ${{env.benchmark_conv_dir}}/no_expand_macros_alltypes/Olden/voronoi
          if [ -e "out.checked" ]; then cp -r out.checked/* . && rm -r out.checked; fi
          make -j $(nproc) -l $(nproc) --output-sync CC="${{env.builddir}}/bin/clang" -k LOCAL_CFLAGS="-w -ferror-limit=0 -D_ISOC99_SOURCE" 2>&1 | ${{github.workspace}}/depsfolder/actions/filter-bounds-inference-errors.py || echo voronoi >>${{env.benchmark_conv_dir}}/no_expand_macros_alltypes/Olden/failed-components-list.txt

      - name: Check for deferred post-conversion build failures
        run: |
          if [ -e ${{env.benchmark_conv_dir}}/no_expand_macros_alltypes/Olden/failed-components-list.txt ]; then
              echo 'Failed components (see previous post-conversion build steps):'
              cat ${{env.benchmark_conv_dir}}/no_expand_macros_alltypes/Olden/failed-components-list.txt
              exit 1
          fi

  test_Olden_expand_macros_no_alltypes:
    name: Test Olden (macro-expanded, no -alltypes)
    needs: build_3c
    runs-on: self-hosted
    steps:
      - name: Build Olden
        run: |
          mkdir -p ${{env.benchmark_conv_dir}}/expand_macros_no_alltypes
          cd ${{env.benchmark_conv_dir}}/expand_macros_no_alltypes
          tar -xvzf ${{env.benchmark_tar_dir}}/Olden.tar.gz
          cd Olden
          for i in bh bisort em3d health mst perimeter power treeadd tsp voronoi ; do \
            (cd $i ; bear make -j $(nproc) -l $(nproc) --output-sync CC="${{env.builddir}}/bin/clang" LOCAL_CFLAGS="-w -ferror-limit=0 -D_ISOC99_SOURCE") \
          done

      - name: Convert bh
        run: |
          cd ${{env.benchmark_conv_dir}}/expand_macros_no_alltypes/Olden/bh
          ${{env.port_tools}}/convert_project.py \
            --extra-3c-arg=-allow-unwritable-changes \
            --prog_name ${{env.builddir}}/bin/3c \
            --expand_macros_before_conversion \
            --project_path .

      - name: Build converted bh (defer failure)
        run: |
          cd ${{env.benchmark_conv_dir}}/expand_macros_no_alltypes/Olden/bh
          if [ -e "out.checked" ]; then cp -r out.checked/* . && rm -r out.checked; fi
          make -j $(nproc) -l $(nproc) --output-sync CC="${{env.builddir}}/bin/clang" -k LOCAL_CFLAGS="-w -ferror-limit=0 -D_ISOC99_SOURCE" || echo bh >>${{env.benchmark_conv_dir}}/expand_macros_no_alltypes/Olden/failed-components-list.txt

      - name: Convert bisort
        run: |
          cd ${{env.benchmark_conv_dir}}/expand_macros_no_alltypes/Olden/bisort
          ${{env.port_tools}}/convert_project.py \
            --extra-3c-arg=-allow-unwritable-changes \
            --prog_name ${{env.builddir}}/bin/3c \
            --expand_macros_before_conversion \
            --project_path .

      - name: Build converted bisort (defer failure)
        run: |
          cd ${{env.benchmark_conv_dir}}/expand_macros_no_alltypes/Olden/bisort
          if [ -e "out.checked" ]; then cp -r out.checked/* . && rm -r out.checked; fi
          make -j $(nproc) -l $(nproc) --output-sync CC="${{env.builddir}}/bin/clang" -k LOCAL_CFLAGS="-w -ferror-limit=0 -D_ISOC99_SOURCE" || echo bisort >>${{env.benchmark_conv_dir}}/expand_macros_no_alltypes/Olden/failed-components-list.txt

      - name: Convert em3d
        run: |
          cd ${{env.benchmark_conv_dir}}/expand_macros_no_alltypes/Olden/em3d
          ${{env.port_tools}}/convert_project.py \
            --extra-3c-arg=-allow-unwritable-changes \
            --prog_name ${{env.builddir}}/bin/3c \
            --expand_macros_before_conversion \
            --project_path .

      - name: Build converted em3d (defer failure)
        run: |
          cd ${{env.benchmark_conv_dir}}/expand_macros_no_alltypes/Olden/em3d
          if [ -e "out.checked" ]; then cp -r out.checked/* . && rm -r out.checked; fi
          make -j $(nproc) -l $(nproc) --output-sync CC="${{env.builddir}}/bin/clang" -k LOCAL_CFLAGS="-w -ferror-limit=0 -D_ISOC99_SOURCE" || echo em3d >>${{env.benchmark_conv_dir}}/expand_macros_no_alltypes/Olden/failed-components-list.txt

      - name: Convert health
        run: |
          cd ${{env.benchmark_conv_dir}}/expand_macros_no_alltypes/Olden/health
          ${{env.port_tools}}/convert_project.py \
            --extra-3c-arg=-allow-unwritable-changes \
            --prog_name ${{env.builddir}}/bin/3c \
            --expand_macros_before_conversion \
            --project_path .

      - name: Build converted health (defer failure)
        run: |
          cd ${{env.benchmark_conv_dir}}/expand_macros_no_alltypes/Olden/health
          if [ -e "out.checked" ]; then cp -r out.checked/* . && rm -r out.checked; fi
          make -j $(nproc) -l $(nproc) --output-sync CC="${{env.builddir}}/bin/clang" -k LOCAL_CFLAGS="-w -ferror-limit=0 -D_ISOC99_SOURCE" || echo health >>${{env.benchmark_conv_dir}}/expand_macros_no_alltypes/Olden/failed-components-list.txt

      - name: Convert mst
        run: |
          cd ${{env.benchmark_conv_dir}}/expand_macros_no_alltypes/Olden/mst
          ${{env.port_tools}}/convert_project.py \
            --extra-3c-arg=-allow-unwritable-changes \
            --prog_name ${{env.builddir}}/bin/3c \
            --expand_macros_before_conversion \
            --project_path .

      - name: Build converted mst (defer failure)
        run: |
          cd ${{env.benchmark_conv_dir}}/expand_macros_no_alltypes/Olden/mst
          if [ -e "out.checked" ]; then cp -r out.checked/* . && rm -r out.checked; fi
          make -j $(nproc) -l $(nproc) --output-sync CC="${{env.builddir}}/bin/clang" -k LOCAL_CFLAGS="-w -ferror-limit=0 -D_ISOC99_SOURCE" || echo mst >>${{env.benchmark_conv_dir}}/expand_macros_no_alltypes/Olden/failed-components-list.txt

      - name: Convert perimeter
        run: |
          cd ${{env.benchmark_conv_dir}}/expand_macros_no_alltypes/Olden/perimeter
          ${{env.port_tools}}/convert_project.py \
            --extra-3c-arg=-allow-unwritable-changes \
            --prog_name ${{env.builddir}}/bin/3c \
            --expand_macros_before_conversion \
            --project_path .

      - name: Build converted perimeter (defer failure)
        run: |
          cd ${{env.benchmark_conv_dir}}/expand_macros_no_alltypes/Olden/perimeter
          if [ -e "out.checked" ]; then cp -r out.checked/* . && rm -r out.checked; fi
          make -j $(nproc) -l $(nproc) --output-sync CC="${{env.builddir}}/bin/clang" -k LOCAL_CFLAGS="-w -ferror-limit=0 -D_ISOC99_SOURCE" || echo perimeter >>${{env.benchmark_conv_dir}}/expand_macros_no_alltypes/Olden/failed-components-list.txt

      - name: Convert power
        run: |
          cd ${{env.benchmark_conv_dir}}/expand_macros_no_alltypes/Olden/power
          ${{env.port_tools}}/convert_project.py \
            --extra-3c-arg=-allow-unwritable-changes \
            --prog_name ${{env.builddir}}/bin/3c \
            --expand_macros_before_conversion \
            --project_path .

      - name: Build converted power (defer failure)
        run: |
          cd ${{env.benchmark_conv_dir}}/expand_macros_no_alltypes/Olden/power
          if [ -e "out.checked" ]; then cp -r out.checked/* . && rm -r out.checked; fi
          make -j $(nproc) -l $(nproc) --output-sync CC="${{env.builddir}}/bin/clang" -k LOCAL_CFLAGS="-w -ferror-limit=0 -D_ISOC99_SOURCE" || echo power >>${{env.benchmark_conv_dir}}/expand_macros_no_alltypes/Olden/failed-components-list.txt

      - name: Convert treeadd
        run: |
          cd ${{env.benchmark_conv_dir}}/expand_macros_no_alltypes/Olden/treeadd
          ${{env.port_tools}}/convert_project.py \
            --extra-3c-arg=-allow-unwritable-changes \
            --prog_name ${{env.builddir}}/bin/3c \
            --expand_macros_before_conversion \
            --project_path .

      - name: Build converted treeadd (defer failure)
        run: |
          cd ${{env.benchmark_conv_dir}}/expand_macros_no_alltypes/Olden/treeadd
          if [ -e "out.checked" ]; then cp -r out.checked/* . && rm -r out.checked; fi
          make -j $(nproc) -l $(nproc) --output-sync CC="${{env.builddir}}/bin/clang" -k LOCAL_CFLAGS="-w -ferror-limit=0 -D_ISOC99_SOURCE" || echo treeadd >>${{env.benchmark_conv_dir}}/expand_macros_no_alltypes/Olden/failed-components-list.txt

      - name: Convert tsp
        run: |
          cd ${{env.benchmark_conv_dir}}/expand_macros_no_alltypes/Olden/tsp
          ${{env.port_tools}}/convert_project.py \
            --extra-3c-arg=-allow-unwritable-changes \
            --prog_name ${{env.builddir}}/bin/3c \
            --expand_macros_before_conversion \
            --project_path .

      - name: Build converted tsp (defer failure)
        run: |
          cd ${{env.benchmark_conv_dir}}/expand_macros_no_alltypes/Olden/tsp
          if [ -e "out.checked" ]; then cp -r out.checked/* . && rm -r out.checked; fi
          make -j $(nproc) -l $(nproc) --output-sync CC="${{env.builddir}}/bin/clang" -k LOCAL_CFLAGS="-w -ferror-limit=0 -D_ISOC99_SOURCE" || echo tsp >>${{env.benchmark_conv_dir}}/expand_macros_no_alltypes/Olden/failed-components-list.txt

      - name: Convert voronoi
        run: |
          cd ${{env.benchmark_conv_dir}}/expand_macros_no_alltypes/Olden/voronoi
          ${{env.port_tools}}/convert_project.py \
            --extra-3c-arg=-allow-unwritable-changes \
            --prog_name ${{env.builddir}}/bin/3c \
            --expand_macros_before_conversion \
            --project_path .

      - name: Build converted voronoi (defer failure)
        run: |
          cd ${{env.benchmark_conv_dir}}/expand_macros_no_alltypes/Olden/voronoi
          if [ -e "out.checked" ]; then cp -r out.checked/* . && rm -r out.checked; fi
          make -j $(nproc) -l $(nproc) --output-sync CC="${{env.builddir}}/bin/clang" -k LOCAL_CFLAGS="-w -ferror-limit=0 -D_ISOC99_SOURCE" || echo voronoi >>${{env.benchmark_conv_dir}}/expand_macros_no_alltypes/Olden/failed-components-list.txt

      - name: Check for deferred post-conversion build failures
        run: |
          if [ -e ${{env.benchmark_conv_dir}}/expand_macros_no_alltypes/Olden/failed-components-list.txt ]; then
              echo 'Failed components (see previous post-conversion build steps):'
              cat ${{env.benchmark_conv_dir}}/expand_macros_no_alltypes/Olden/failed-components-list.txt
              exit 1
          fi

  test_Olden_expand_macros_alltypes:
    name: Test Olden (macro-expanded, -alltypes)
    needs: build_3c
    runs-on: self-hosted
    steps:
      - name: Build Olden
        run: |
          mkdir -p ${{env.benchmark_conv_dir}}/expand_macros_alltypes
          cd ${{env.benchmark_conv_dir}}/expand_macros_alltypes
          tar -xvzf ${{env.benchmark_tar_dir}}/Olden.tar.gz
          cd Olden
          for i in bh bisort em3d health mst perimeter power treeadd tsp voronoi ; do \
            (cd $i ; bear make -j $(nproc) -l $(nproc) --output-sync CC="${{env.builddir}}/bin/clang" LOCAL_CFLAGS="-w -ferror-limit=0 -D_ISOC99_SOURCE") \
          done

      - name: Convert bh
        run: |
          cd ${{env.benchmark_conv_dir}}/expand_macros_alltypes/Olden/bh
          ${{env.port_tools}}/convert_project.py \
            --extra-3c-arg=-allow-unwritable-changes \
            --prog_name ${{env.builddir}}/bin/3c \
            --extra-3c-arg=-alltypes \
            --expand_macros_before_conversion \
            --project_path .

      - name: Build converted bh (filter bounds inference errors) (defer failure)
        run: |
          cd ${{env.benchmark_conv_dir}}/expand_macros_alltypes/Olden/bh
          if [ -e "out.checked" ]; then cp -r out.checked/* . && rm -r out.checked; fi
          make -j $(nproc) -l $(nproc) --output-sync CC="${{env.builddir}}/bin/clang" -k LOCAL_CFLAGS="-w -ferror-limit=0 -D_ISOC99_SOURCE" 2>&1 | ${{github.workspace}}/depsfolder/actions/filter-bounds-inference-errors.py || echo bh >>${{env.benchmark_conv_dir}}/expand_macros_alltypes/Olden/failed-components-list.txt

      - name: Convert bisort
        run: |
          cd ${{env.benchmark_conv_dir}}/expand_macros_alltypes/Olden/bisort
          ${{env.port_tools}}/convert_project.py \
            --extra-3c-arg=-allow-unwritable-changes \
            --prog_name ${{env.builddir}}/bin/3c \
            --extra-3c-arg=-alltypes \
            --expand_macros_before_conversion \
            --project_path .

      - name: Build converted bisort (filter bounds inference errors) (defer failure)
        run: |
          cd ${{env.benchmark_conv_dir}}/expand_macros_alltypes/Olden/bisort
          if [ -e "out.checked" ]; then cp -r out.checked/* . && rm -r out.checked; fi
          make -j $(nproc) -l $(nproc) --output-sync CC="${{env.builddir}}/bin/clang" -k LOCAL_CFLAGS="-w -ferror-limit=0 -D_ISOC99_SOURCE" 2>&1 | ${{github.workspace}}/depsfolder/actions/filter-bounds-inference-errors.py || echo bisort >>${{env.benchmark_conv_dir}}/expand_macros_alltypes/Olden/failed-components-list.txt

      - name: Convert em3d
        run: |
          cd ${{env.benchmark_conv_dir}}/expand_macros_alltypes/Olden/em3d
          ${{env.port_tools}}/convert_project.py \
            --extra-3c-arg=-allow-unwritable-changes \
            --prog_name ${{env.builddir}}/bin/3c \
            --extra-3c-arg=-alltypes \
            --expand_macros_before_conversion \
            --project_path .

      - name: Build converted em3d (filter bounds inference errors) (defer failure)
        run: |
          cd ${{env.benchmark_conv_dir}}/expand_macros_alltypes/Olden/em3d
          if [ -e "out.checked" ]; then cp -r out.checked/* . && rm -r out.checked; fi
          make -j $(nproc) -l $(nproc) --output-sync CC="${{env.builddir}}/bin/clang" -k LOCAL_CFLAGS="-w -ferror-limit=0 -D_ISOC99_SOURCE" 2>&1 | ${{github.workspace}}/depsfolder/actions/filter-bounds-inference-errors.py || echo em3d >>${{env.benchmark_conv_dir}}/expand_macros_alltypes/Olden/failed-components-list.txt

      - name: Convert health
        run: |
          cd ${{env.benchmark_conv_dir}}/expand_macros_alltypes/Olden/health
          ${{env.port_tools}}/convert_project.py \
            --extra-3c-arg=-allow-unwritable-changes \
            --prog_name ${{env.builddir}}/bin/3c \
            --extra-3c-arg=-alltypes \
            --expand_macros_before_conversion \
            --project_path .

      - name: Build converted health (filter bounds inference errors) (defer failure)
        run: |
          cd ${{env.benchmark_conv_dir}}/expand_macros_alltypes/Olden/health
          if [ -e "out.checked" ]; then cp -r out.checked/* . && rm -r out.checked; fi
          make -j $(nproc) -l $(nproc) --output-sync CC="${{env.builddir}}/bin/clang" -k LOCAL_CFLAGS="-w -ferror-limit=0 -D_ISOC99_SOURCE" 2>&1 | ${{github.workspace}}/depsfolder/actions/filter-bounds-inference-errors.py || echo health >>${{env.benchmark_conv_dir}}/expand_macros_alltypes/Olden/failed-components-list.txt

      - name: Convert mst
        run: |
          cd ${{env.benchmark_conv_dir}}/expand_macros_alltypes/Olden/mst
          ${{env.port_tools}}/convert_project.py \
            --extra-3c-arg=-allow-unwritable-changes \
            --prog_name ${{env.builddir}}/bin/3c \
            --extra-3c-arg=-alltypes \
            --expand_macros_before_conversion \
            --project_path .

      - name: Build converted mst (filter bounds inference errors) (defer failure)
        run: |
          cd ${{env.benchmark_conv_dir}}/expand_macros_alltypes/Olden/mst
          if [ -e "out.checked" ]; then cp -r out.checked/* . && rm -r out.checked; fi
          make -j $(nproc) -l $(nproc) --output-sync CC="${{env.builddir}}/bin/clang" -k LOCAL_CFLAGS="-w -ferror-limit=0 -D_ISOC99_SOURCE" 2>&1 | ${{github.workspace}}/depsfolder/actions/filter-bounds-inference-errors.py || echo mst >>${{env.benchmark_conv_dir}}/expand_macros_alltypes/Olden/failed-components-list.txt

      - name: Convert perimeter
        run: |
          cd ${{env.benchmark_conv_dir}}/expand_macros_alltypes/Olden/perimeter
          ${{env.port_tools}}/convert_project.py \
            --extra-3c-arg=-allow-unwritable-changes \
            --prog_name ${{env.builddir}}/bin/3c \
            --extra-3c-arg=-alltypes \
            --expand_macros_before_conversion \
            --project_path .

      - name: Build converted perimeter (filter bounds inference errors) (defer failure)
        run: |
          cd ${{env.benchmark_conv_dir}}/expand_macros_alltypes/Olden/perimeter
          if [ -e "out.checked" ]; then cp -r out.checked/* . && rm -r out.checked; fi
          make -j $(nproc) -l $(nproc) --output-sync CC="${{env.builddir}}/bin/clang" -k LOCAL_CFLAGS="-w -ferror-limit=0 -D_ISOC99_SOURCE" 2>&1 | ${{github.workspace}}/depsfolder/actions/filter-bounds-inference-errors.py || echo perimeter >>${{env.benchmark_conv_dir}}/expand_macros_alltypes/Olden/failed-components-list.txt

      - name: Convert power
        run: |
          cd ${{env.benchmark_conv_dir}}/expand_macros_alltypes/Olden/power
          ${{env.port_tools}}/convert_project.py \
            --extra-3c-arg=-allow-unwritable-changes \
            --prog_name ${{env.builddir}}/bin/3c \
            --extra-3c-arg=-alltypes \
            --expand_macros_before_conversion \
            --project_path .

      - name: Build converted power (filter bounds inference errors) (defer failure)
        run: |
          cd ${{env.benchmark_conv_dir}}/expand_macros_alltypes/Olden/power
          if [ -e "out.checked" ]; then cp -r out.checked/* . && rm -r out.checked; fi
          make -j $(nproc) -l $(nproc) --output-sync CC="${{env.builddir}}/bin/clang" -k LOCAL_CFLAGS="-w -ferror-limit=0 -D_ISOC99_SOURCE" 2>&1 | ${{github.workspace}}/depsfolder/actions/filter-bounds-inference-errors.py || echo power >>${{env.benchmark_conv_dir}}/expand_macros_alltypes/Olden/failed-components-list.txt

      - name: Convert treeadd
        run: |
          cd ${{env.benchmark_conv_dir}}/expand_macros_alltypes/Olden/treeadd
          ${{env.port_tools}}/convert_project.py \
            --extra-3c-arg=-allow-unwritable-changes \
            --prog_name ${{env.builddir}}/bin/3c \
            --extra-3c-arg=-alltypes \
            --expand_macros_before_conversion \
            --project_path .

      - name: Build converted treeadd (filter bounds inference errors) (defer failure)
        run: |
          cd ${{env.benchmark_conv_dir}}/expand_macros_alltypes/Olden/treeadd
          if [ -e "out.checked" ]; then cp -r out.checked/* . && rm -r out.checked; fi
          make -j $(nproc) -l $(nproc) --output-sync CC="${{env.builddir}}/bin/clang" -k LOCAL_CFLAGS="-w -ferror-limit=0 -D_ISOC99_SOURCE" 2>&1 | ${{github.workspace}}/depsfolder/actions/filter-bounds-inference-errors.py || echo treeadd >>${{env.benchmark_conv_dir}}/expand_macros_alltypes/Olden/failed-components-list.txt

      - name: Convert tsp
        run: |
          cd ${{env.benchmark_conv_dir}}/expand_macros_alltypes/Olden/tsp
          ${{env.port_tools}}/convert_project.py \
            --extra-3c-arg=-allow-unwritable-changes \
            --prog_name ${{env.builddir}}/bin/3c \
            --extra-3c-arg=-alltypes \
            --expand_macros_before_conversion \
            --project_path .

      - name: Build converted tsp (filter bounds inference errors) (defer failure)
        run: |
          cd ${{env.benchmark_conv_dir}}/expand_macros_alltypes/Olden/tsp
          if [ -e "out.checked" ]; then cp -r out.checked/* . && rm -r out.checked; fi
          make -j $(nproc) -l $(nproc) --output-sync CC="${{env.builddir}}/bin/clang" -k LOCAL_CFLAGS="-w -ferror-limit=0 -D_ISOC99_SOURCE" 2>&1 | ${{github.workspace}}/depsfolder/actions/filter-bounds-inference-errors.py || echo tsp >>${{env.benchmark_conv_dir}}/expand_macros_alltypes/Olden/failed-components-list.txt

      - name: Convert voronoi
        run: |
          cd ${{env.benchmark_conv_dir}}/expand_macros_alltypes/Olden/voronoi
          ${{env.port_tools}}/convert_project.py \
            --extra-3c-arg=-allow-unwritable-changes \
            --prog_name ${{env.builddir}}/bin/3c \
            --extra-3c-arg=-alltypes \
            --expand_macros_before_conversion \
            --project_path .

      - name: Build converted voronoi (filter bounds inference errors) (defer failure)
        run: |
          cd ${{env.benchmark_conv_dir}}/expand_macros_alltypes/Olden/voronoi
          if [ -e "out.checked" ]; then cp -r out.checked/* . && rm -r out.checked; fi
          make -j $(nproc) -l $(nproc) --output-sync CC="${{env.builddir}}/bin/clang" -k LOCAL_CFLAGS="-w -ferror-limit=0 -D_ISOC99_SOURCE" 2>&1 | ${{github.workspace}}/depsfolder/actions/filter-bounds-inference-errors.py || echo voronoi >>${{env.benchmark_conv_dir}}/expand_macros_alltypes/Olden/failed-components-list.txt

      - name: Check for deferred post-conversion build failures
        run: |
          if [ -e ${{env.benchmark_conv_dir}}/expand_macros_alltypes/Olden/failed-components-list.txt ]; then
              echo 'Failed components (see previous post-conversion build steps):'
              cat ${{env.benchmark_conv_dir}}/expand_macros_alltypes/Olden/failed-components-list.txt
              exit 1
          fi

  test_ptrdist_no_expand_macros_no_alltypes:
    name: Test PtrDist (not macro-expanded, no -alltypes)
    needs: build_3c
    runs-on: self-hosted
    steps:
      - name: Build PtrDist
        run: |
          mkdir -p ${{env.benchmark_conv_dir}}/no_expand_macros_no_alltypes
          cd ${{env.benchmark_conv_dir}}/no_expand_macros_no_alltypes
          tar -xvzf ${{env.benchmark_tar_dir}}/ptrdist-1.1.tar.gz
          cd ptrdist-1.1
          ( cd yacr2 ; \
            sed -Ei 's/^long (.*costMatrix)/ulong \1/' assign.h
            for header in *.h  ; do
              src="$(basename "$header" .h).c"
              new_header="$(basename "$header" .h)_code.h"
              test -e "$src" || continue
              sed -ne '/^#ifdef.*CODE/,/#else.*CODE/{ /^#/!p; }' "$header" >"$new_header"
              sed -i "/#define.*_CODE/d; /#include \"$header\"/a#include \"$new_header\"" "$src"
            done )
          for i in anagram bc ft ks yacr2 ; do \
            (cd $i ; bear make -j $(nproc) -l $(nproc) --output-sync CC="${{env.builddir}}/bin/clang" LOCAL_CFLAGS="-w -ferror-limit=0 -D_ISOC99_SOURCE") \
          done

      - name: Convert anagram
        run: |
          cd ${{env.benchmark_conv_dir}}/no_expand_macros_no_alltypes/ptrdist-1.1/anagram
          ${{env.port_tools}}/convert_project.py \
            --prog_name ${{env.builddir}}/bin/3c \
            --project_path .

      - name: Build converted anagram (defer failure)
        run: |
          cd ${{env.benchmark_conv_dir}}/no_expand_macros_no_alltypes/ptrdist-1.1/anagram
          if [ -e "out.checked" ]; then cp -r out.checked/* . && rm -r out.checked; fi
          make -j $(nproc) -l $(nproc) --output-sync CC="${{env.builddir}}/bin/clang" -k LOCAL_CFLAGS="-w -ferror-limit=0 -D_ISOC99_SOURCE" || echo anagram >>${{env.benchmark_conv_dir}}/no_expand_macros_no_alltypes/ptrdist-1.1/failed-components-list.txt

      - name: Convert bc
        run: |
          cd ${{env.benchmark_conv_dir}}/no_expand_macros_no_alltypes/ptrdist-1.1/bc
          ${{env.port_tools}}/convert_project.py \
            --prog_name ${{env.builddir}}/bin/3c \
            --project_path .

      - name: Build converted bc (defer failure)
        run: |
          cd ${{env.benchmark_conv_dir}}/no_expand_macros_no_alltypes/ptrdist-1.1/bc
          if [ -e "out.checked" ]; then cp -r out.checked/* . && rm -r out.checked; fi
          make -j $(nproc) -l $(nproc) --output-sync CC="${{env.builddir}}/bin/clang" -k LOCAL_CFLAGS="-w -ferror-limit=0 -D_ISOC99_SOURCE" || echo bc >>${{env.benchmark_conv_dir}}/no_expand_macros_no_alltypes/ptrdist-1.1/failed-components-list.txt

      - name: Convert ft
        run: |
          cd ${{env.benchmark_conv_dir}}/no_expand_macros_no_alltypes/ptrdist-1.1/ft
          ${{env.port_tools}}/convert_project.py \
            --prog_name ${{env.builddir}}/bin/3c \
            --project_path .

      - name: Build converted ft (defer failure)
        run: |
          cd ${{env.benchmark_conv_dir}}/no_expand_macros_no_alltypes/ptrdist-1.1/ft
          if [ -e "out.checked" ]; then cp -r out.checked/* . && rm -r out.checked; fi
          make -j $(nproc) -l $(nproc) --output-sync CC="${{env.builddir}}/bin/clang" -k LOCAL_CFLAGS="-w -ferror-limit=0 -D_ISOC99_SOURCE" || echo ft >>${{env.benchmark_conv_dir}}/no_expand_macros_no_alltypes/ptrdist-1.1/failed-components-list.txt

      - name: Convert ks
        run: |
          cd ${{env.benchmark_conv_dir}}/no_expand_macros_no_alltypes/ptrdist-1.1/ks
          ${{env.port_tools}}/convert_project.py \
            --prog_name ${{env.builddir}}/bin/3c \
            --project_path .

      - name: Build converted ks (defer failure)
        run: |
          cd ${{env.benchmark_conv_dir}}/no_expand_macros_no_alltypes/ptrdist-1.1/ks
          if [ -e "out.checked" ]; then cp -r out.checked/* . && rm -r out.checked; fi
          make -j $(nproc) -l $(nproc) --output-sync CC="${{env.builddir}}/bin/clang" -k LOCAL_CFLAGS="-w -ferror-limit=0 -D_ISOC99_SOURCE" || echo ks >>${{env.benchmark_conv_dir}}/no_expand_macros_no_alltypes/ptrdist-1.1/failed-components-list.txt

      - name: Convert yacr2
        run: |
          cd ${{env.benchmark_conv_dir}}/no_expand_macros_no_alltypes/ptrdist-1.1/yacr2
          ${{env.port_tools}}/convert_project.py \
            --prog_name ${{env.builddir}}/bin/3c \
            --project_path .

      - name: Build converted yacr2 (defer failure)
        run: |
          cd ${{env.benchmark_conv_dir}}/no_expand_macros_no_alltypes/ptrdist-1.1/yacr2
          if [ -e "out.checked" ]; then cp -r out.checked/* . && rm -r out.checked; fi
          make -j $(nproc) -l $(nproc) --output-sync CC="${{env.builddir}}/bin/clang" -k LOCAL_CFLAGS="-w -ferror-limit=0 -D_ISOC99_SOURCE" || echo yacr2 >>${{env.benchmark_conv_dir}}/no_expand_macros_no_alltypes/ptrdist-1.1/failed-components-list.txt

      - name: Check for deferred post-conversion build failures
        run: |
          if [ -e ${{env.benchmark_conv_dir}}/no_expand_macros_no_alltypes/ptrdist-1.1/failed-components-list.txt ]; then
              echo 'Failed components (see previous post-conversion build steps):'
              cat ${{env.benchmark_conv_dir}}/no_expand_macros_no_alltypes/ptrdist-1.1/failed-components-list.txt
              exit 1
          fi

  test_ptrdist_no_expand_macros_alltypes:
    name: Test PtrDist (not macro-expanded, -alltypes)
    needs: build_3c
    runs-on: self-hosted
    steps:
      - name: Build PtrDist
        run: |
          mkdir -p ${{env.benchmark_conv_dir}}/no_expand_macros_alltypes
          cd ${{env.benchmark_conv_dir}}/no_expand_macros_alltypes
          tar -xvzf ${{env.benchmark_tar_dir}}/ptrdist-1.1.tar.gz
          cd ptrdist-1.1
          ( cd yacr2 ; \
            sed -Ei 's/^long (.*costMatrix)/ulong \1/' assign.h
            for header in *.h  ; do
              src="$(basename "$header" .h).c"
              new_header="$(basename "$header" .h)_code.h"
              test -e "$src" || continue
              sed -ne '/^#ifdef.*CODE/,/#else.*CODE/{ /^#/!p; }' "$header" >"$new_header"
              sed -i "/#define.*_CODE/d; /#include \"$header\"/a#include \"$new_header\"" "$src"
            done )
          for i in anagram bc ft ks yacr2 ; do \
            (cd $i ; bear make -j $(nproc) -l $(nproc) --output-sync CC="${{env.builddir}}/bin/clang" LOCAL_CFLAGS="-w -ferror-limit=0 -D_ISOC99_SOURCE") \
          done

      - name: Convert anagram
        run: |
          cd ${{env.benchmark_conv_dir}}/no_expand_macros_alltypes/ptrdist-1.1/anagram
          ${{env.port_tools}}/convert_project.py \
            --prog_name ${{env.builddir}}/bin/3c \
            --extra-3c-arg=-alltypes \
            --project_path .

      - name: Build converted anagram (filter bounds inference errors) (defer failure)
        run: |
          cd ${{env.benchmark_conv_dir}}/no_expand_macros_alltypes/ptrdist-1.1/anagram
          if [ -e "out.checked" ]; then cp -r out.checked/* . && rm -r out.checked; fi
          make -j $(nproc) -l $(nproc) --output-sync CC="${{env.builddir}}/bin/clang" -k LOCAL_CFLAGS="-w -ferror-limit=0 -D_ISOC99_SOURCE" 2>&1 | ${{github.workspace}}/depsfolder/actions/filter-bounds-inference-errors.py || echo anagram >>${{env.benchmark_conv_dir}}/no_expand_macros_alltypes/ptrdist-1.1/failed-components-list.txt

      - name: Convert bc
        run: |
          cd ${{env.benchmark_conv_dir}}/no_expand_macros_alltypes/ptrdist-1.1/bc
          ${{env.port_tools}}/convert_project.py \
            --prog_name ${{env.builddir}}/bin/3c \
            --extra-3c-arg=-alltypes \
            --project_path .

      - name: Build converted bc (filter bounds inference errors) (defer failure)
        run: |
          cd ${{env.benchmark_conv_dir}}/no_expand_macros_alltypes/ptrdist-1.1/bc
          if [ -e "out.checked" ]; then cp -r out.checked/* . && rm -r out.checked; fi
          make -j $(nproc) -l $(nproc) --output-sync CC="${{env.builddir}}/bin/clang" -k LOCAL_CFLAGS="-w -ferror-limit=0 -D_ISOC99_SOURCE" 2>&1 | ${{github.workspace}}/depsfolder/actions/filter-bounds-inference-errors.py || echo bc >>${{env.benchmark_conv_dir}}/no_expand_macros_alltypes/ptrdist-1.1/failed-components-list.txt

      - name: Convert ft
        run: |
          cd ${{env.benchmark_conv_dir}}/no_expand_macros_alltypes/ptrdist-1.1/ft
          ${{env.port_tools}}/convert_project.py \
            --prog_name ${{env.builddir}}/bin/3c \
            --extra-3c-arg=-alltypes \
            --project_path .

      - name: Build converted ft (filter bounds inference errors) (defer failure)
        run: |
          cd ${{env.benchmark_conv_dir}}/no_expand_macros_alltypes/ptrdist-1.1/ft
          if [ -e "out.checked" ]; then cp -r out.checked/* . && rm -r out.checked; fi
          make -j $(nproc) -l $(nproc) --output-sync CC="${{env.builddir}}/bin/clang" -k LOCAL_CFLAGS="-w -ferror-limit=0 -D_ISOC99_SOURCE" 2>&1 | ${{github.workspace}}/depsfolder/actions/filter-bounds-inference-errors.py || echo ft >>${{env.benchmark_conv_dir}}/no_expand_macros_alltypes/ptrdist-1.1/failed-components-list.txt

      - name: Convert ks
        run: |
          cd ${{env.benchmark_conv_dir}}/no_expand_macros_alltypes/ptrdist-1.1/ks
          ${{env.port_tools}}/convert_project.py \
            --prog_name ${{env.builddir}}/bin/3c \
            --extra-3c-arg=-alltypes \
            --project_path .

      - name: Build converted ks (filter bounds inference errors) (defer failure)
        run: |
          cd ${{env.benchmark_conv_dir}}/no_expand_macros_alltypes/ptrdist-1.1/ks
          if [ -e "out.checked" ]; then cp -r out.checked/* . && rm -r out.checked; fi
          make -j $(nproc) -l $(nproc) --output-sync CC="${{env.builddir}}/bin/clang" -k LOCAL_CFLAGS="-w -ferror-limit=0 -D_ISOC99_SOURCE" 2>&1 | ${{github.workspace}}/depsfolder/actions/filter-bounds-inference-errors.py || echo ks >>${{env.benchmark_conv_dir}}/no_expand_macros_alltypes/ptrdist-1.1/failed-components-list.txt

      - name: Convert yacr2
        run: |
          cd ${{env.benchmark_conv_dir}}/no_expand_macros_alltypes/ptrdist-1.1/yacr2
          ${{env.port_tools}}/convert_project.py \
            --prog_name ${{env.builddir}}/bin/3c \
            --extra-3c-arg=-alltypes \
            --project_path .

      - name: Build converted yacr2 (filter bounds inference errors) (defer failure)
        run: |
          cd ${{env.benchmark_conv_dir}}/no_expand_macros_alltypes/ptrdist-1.1/yacr2
          if [ -e "out.checked" ]; then cp -r out.checked/* . && rm -r out.checked; fi
          make -j $(nproc) -l $(nproc) --output-sync CC="${{env.builddir}}/bin/clang" -k LOCAL_CFLAGS="-w -ferror-limit=0 -D_ISOC99_SOURCE" 2>&1 | ${{github.workspace}}/depsfolder/actions/filter-bounds-inference-errors.py || echo yacr2 >>${{env.benchmark_conv_dir}}/no_expand_macros_alltypes/ptrdist-1.1/failed-components-list.txt

      - name: Check for deferred post-conversion build failures
        run: |
          if [ -e ${{env.benchmark_conv_dir}}/no_expand_macros_alltypes/ptrdist-1.1/failed-components-list.txt ]; then
              echo 'Failed components (see previous post-conversion build steps):'
              cat ${{env.benchmark_conv_dir}}/no_expand_macros_alltypes/ptrdist-1.1/failed-components-list.txt
              exit 1
          fi

  test_ptrdist_expand_macros_no_alltypes:
    name: Test PtrDist (macro-expanded, no -alltypes)
    needs: build_3c
    runs-on: self-hosted
    steps:
      - name: Build PtrDist
        run: |
          mkdir -p ${{env.benchmark_conv_dir}}/expand_macros_no_alltypes
          cd ${{env.benchmark_conv_dir}}/expand_macros_no_alltypes
          tar -xvzf ${{env.benchmark_tar_dir}}/ptrdist-1.1.tar.gz
          cd ptrdist-1.1
          ( cd yacr2 ; \
            sed -Ei 's/^long (.*costMatrix)/ulong \1/' assign.h
            for header in *.h  ; do
              src="$(basename "$header" .h).c"
              new_header="$(basename "$header" .h)_code.h"
              test -e "$src" || continue
              sed -ne '/^#ifdef.*CODE/,/#else.*CODE/{ /^#/!p; }' "$header" >"$new_header"
              sed -i "/#define.*_CODE/d; /#include \"$header\"/a#include \"$new_header\"" "$src"
            done )
          for i in anagram bc ft ks yacr2 ; do \
            (cd $i ; bear make -j $(nproc) -l $(nproc) --output-sync CC="${{env.builddir}}/bin/clang" LOCAL_CFLAGS="-w -ferror-limit=0 -D_ISOC99_SOURCE") \
          done

      - name: Convert anagram
        run: |
          cd ${{env.benchmark_conv_dir}}/expand_macros_no_alltypes/ptrdist-1.1/anagram
          ${{env.port_tools}}/convert_project.py \
            --prog_name ${{env.builddir}}/bin/3c \
            --expand_macros_before_conversion \
            --project_path .

      - name: Build converted anagram (defer failure)
        run: |
          cd ${{env.benchmark_conv_dir}}/expand_macros_no_alltypes/ptrdist-1.1/anagram
          if [ -e "out.checked" ]; then cp -r out.checked/* . && rm -r out.checked; fi
          make -j $(nproc) -l $(nproc) --output-sync CC="${{env.builddir}}/bin/clang" -k LOCAL_CFLAGS="-w -ferror-limit=0 -D_ISOC99_SOURCE" || echo anagram >>${{env.benchmark_conv_dir}}/expand_macros_no_alltypes/ptrdist-1.1/failed-components-list.txt

      - name: Convert bc
        run: |
          cd ${{env.benchmark_conv_dir}}/expand_macros_no_alltypes/ptrdist-1.1/bc
          ${{env.port_tools}}/convert_project.py \
            --prog_name ${{env.builddir}}/bin/3c \
            --expand_macros_before_conversion \
            --project_path .

      - name: Build converted bc (defer failure)
        run: |
          cd ${{env.benchmark_conv_dir}}/expand_macros_no_alltypes/ptrdist-1.1/bc
          if [ -e "out.checked" ]; then cp -r out.checked/* . && rm -r out.checked; fi
          make -j $(nproc) -l $(nproc) --output-sync CC="${{env.builddir}}/bin/clang" -k LOCAL_CFLAGS="-w -ferror-limit=0 -D_ISOC99_SOURCE" || echo bc >>${{env.benchmark_conv_dir}}/expand_macros_no_alltypes/ptrdist-1.1/failed-components-list.txt

      - name: Convert ft
        run: |
          cd ${{env.benchmark_conv_dir}}/expand_macros_no_alltypes/ptrdist-1.1/ft
          ${{env.port_tools}}/convert_project.py \
            --prog_name ${{env.builddir}}/bin/3c \
            --expand_macros_before_conversion \
            --project_path .

      - name: Build converted ft (defer failure)
        run: |
          cd ${{env.benchmark_conv_dir}}/expand_macros_no_alltypes/ptrdist-1.1/ft
          if [ -e "out.checked" ]; then cp -r out.checked/* . && rm -r out.checked; fi
          make -j $(nproc) -l $(nproc) --output-sync CC="${{env.builddir}}/bin/clang" -k LOCAL_CFLAGS="-w -ferror-limit=0 -D_ISOC99_SOURCE" || echo ft >>${{env.benchmark_conv_dir}}/expand_macros_no_alltypes/ptrdist-1.1/failed-components-list.txt

      - name: Convert ks
        run: |
          cd ${{env.benchmark_conv_dir}}/expand_macros_no_alltypes/ptrdist-1.1/ks
          ${{env.port_tools}}/convert_project.py \
            --prog_name ${{env.builddir}}/bin/3c \
            --expand_macros_before_conversion \
            --project_path .

      - name: Build converted ks (defer failure)
        run: |
          cd ${{env.benchmark_conv_dir}}/expand_macros_no_alltypes/ptrdist-1.1/ks
          if [ -e "out.checked" ]; then cp -r out.checked/* . && rm -r out.checked; fi
          make -j $(nproc) -l $(nproc) --output-sync CC="${{env.builddir}}/bin/clang" -k LOCAL_CFLAGS="-w -ferror-limit=0 -D_ISOC99_SOURCE" || echo ks >>${{env.benchmark_conv_dir}}/expand_macros_no_alltypes/ptrdist-1.1/failed-components-list.txt

      - name: Convert yacr2
        run: |
          cd ${{env.benchmark_conv_dir}}/expand_macros_no_alltypes/ptrdist-1.1/yacr2
          ${{env.port_tools}}/convert_project.py \
            --prog_name ${{env.builddir}}/bin/3c \
            --expand_macros_before_conversion \
            --project_path .

      - name: Build converted yacr2 (defer failure)
        run: |
          cd ${{env.benchmark_conv_dir}}/expand_macros_no_alltypes/ptrdist-1.1/yacr2
          if [ -e "out.checked" ]; then cp -r out.checked/* . && rm -r out.checked; fi
          make -j $(nproc) -l $(nproc) --output-sync CC="${{env.builddir}}/bin/clang" -k LOCAL_CFLAGS="-w -ferror-limit=0 -D_ISOC99_SOURCE" || echo yacr2 >>${{env.benchmark_conv_dir}}/expand_macros_no_alltypes/ptrdist-1.1/failed-components-list.txt

      - name: Check for deferred post-conversion build failures
        run: |
          if [ -e ${{env.benchmark_conv_dir}}/expand_macros_no_alltypes/ptrdist-1.1/failed-components-list.txt ]; then
              echo 'Failed components (see previous post-conversion build steps):'
              cat ${{env.benchmark_conv_dir}}/expand_macros_no_alltypes/ptrdist-1.1/failed-components-list.txt
              exit 1
          fi

  test_ptrdist_expand_macros_alltypes:
    name: Test PtrDist (macro-expanded, -alltypes)
    needs: build_3c
    runs-on: self-hosted
    steps:
      - name: Build PtrDist
        run: |
          mkdir -p ${{env.benchmark_conv_dir}}/expand_macros_alltypes
          cd ${{env.benchmark_conv_dir}}/expand_macros_alltypes
          tar -xvzf ${{env.benchmark_tar_dir}}/ptrdist-1.1.tar.gz
          cd ptrdist-1.1
          ( cd yacr2 ; \
            sed -Ei 's/^long (.*costMatrix)/ulong \1/' assign.h
            for header in *.h  ; do
              src="$(basename "$header" .h).c"
              new_header="$(basename "$header" .h)_code.h"
              test -e "$src" || continue
              sed -ne '/^#ifdef.*CODE/,/#else.*CODE/{ /^#/!p; }' "$header" >"$new_header"
              sed -i "/#define.*_CODE/d; /#include \"$header\"/a#include \"$new_header\"" "$src"
            done )
          for i in anagram bc ft ks yacr2 ; do \
            (cd $i ; bear make -j $(nproc) -l $(nproc) --output-sync CC="${{env.builddir}}/bin/clang" LOCAL_CFLAGS="-w -ferror-limit=0 -D_ISOC99_SOURCE") \
          done

      - name: Convert anagram
        run: |
          cd ${{env.benchmark_conv_dir}}/expand_macros_alltypes/ptrdist-1.1/anagram
          ${{env.port_tools}}/convert_project.py \
            --prog_name ${{env.builddir}}/bin/3c \
            --extra-3c-arg=-alltypes \
            --expand_macros_before_conversion \
            --project_path .

      - name: Build converted anagram (filter bounds inference errors) (defer failure)
        run: |
          cd ${{env.benchmark_conv_dir}}/expand_macros_alltypes/ptrdist-1.1/anagram
          if [ -e "out.checked" ]; then cp -r out.checked/* . && rm -r out.checked; fi
          make -j $(nproc) -l $(nproc) --output-sync CC="${{env.builddir}}/bin/clang" -k LOCAL_CFLAGS="-w -ferror-limit=0 -D_ISOC99_SOURCE" 2>&1 | ${{github.workspace}}/depsfolder/actions/filter-bounds-inference-errors.py || echo anagram >>${{env.benchmark_conv_dir}}/expand_macros_alltypes/ptrdist-1.1/failed-components-list.txt

      - name: Convert bc
        run: |
          cd ${{env.benchmark_conv_dir}}/expand_macros_alltypes/ptrdist-1.1/bc
          ${{env.port_tools}}/convert_project.py \
            --prog_name ${{env.builddir}}/bin/3c \
            --extra-3c-arg=-alltypes \
            --expand_macros_before_conversion \
            --project_path .

      - name: Build converted bc (filter bounds inference errors) (defer failure)
        run: |
          cd ${{env.benchmark_conv_dir}}/expand_macros_alltypes/ptrdist-1.1/bc
          if [ -e "out.checked" ]; then cp -r out.checked/* . && rm -r out.checked; fi
          make -j $(nproc) -l $(nproc) --output-sync CC="${{env.builddir}}/bin/clang" -k LOCAL_CFLAGS="-w -ferror-limit=0 -D_ISOC99_SOURCE" 2>&1 | ${{github.workspace}}/depsfolder/actions/filter-bounds-inference-errors.py || echo bc >>${{env.benchmark_conv_dir}}/expand_macros_alltypes/ptrdist-1.1/failed-components-list.txt

      - name: Convert ft
        run: |
          cd ${{env.benchmark_conv_dir}}/expand_macros_alltypes/ptrdist-1.1/ft
          ${{env.port_tools}}/convert_project.py \
            --prog_name ${{env.builddir}}/bin/3c \
            --extra-3c-arg=-alltypes \
            --expand_macros_before_conversion \
            --project_path .

      - name: Build converted ft (filter bounds inference errors) (defer failure)
        run: |
          cd ${{env.benchmark_conv_dir}}/expand_macros_alltypes/ptrdist-1.1/ft
          if [ -e "out.checked" ]; then cp -r out.checked/* . && rm -r out.checked; fi
          make -j $(nproc) -l $(nproc) --output-sync CC="${{env.builddir}}/bin/clang" -k LOCAL_CFLAGS="-w -ferror-limit=0 -D_ISOC99_SOURCE" 2>&1 | ${{github.workspace}}/depsfolder/actions/filter-bounds-inference-errors.py || echo ft >>${{env.benchmark_conv_dir}}/expand_macros_alltypes/ptrdist-1.1/failed-components-list.txt

      - name: Convert ks
        run: |
          cd ${{env.benchmark_conv_dir}}/expand_macros_alltypes/ptrdist-1.1/ks
          ${{env.port_tools}}/convert_project.py \
            --prog_name ${{env.builddir}}/bin/3c \
            --extra-3c-arg=-alltypes \
            --expand_macros_before_conversion \
            --project_path .

      - name: Build converted ks (filter bounds inference errors) (defer failure)
        run: |
          cd ${{env.benchmark_conv_dir}}/expand_macros_alltypes/ptrdist-1.1/ks
          if [ -e "out.checked" ]; then cp -r out.checked/* . && rm -r out.checked; fi
          make -j $(nproc) -l $(nproc) --output-sync CC="${{env.builddir}}/bin/clang" -k LOCAL_CFLAGS="-w -ferror-limit=0 -D_ISOC99_SOURCE" 2>&1 | ${{github.workspace}}/depsfolder/actions/filter-bounds-inference-errors.py || echo ks >>${{env.benchmark_conv_dir}}/expand_macros_alltypes/ptrdist-1.1/failed-components-list.txt

      - name: Convert yacr2
        run: |
          cd ${{env.benchmark_conv_dir}}/expand_macros_alltypes/ptrdist-1.1/yacr2
          ${{env.port_tools}}/convert_project.py \
            --prog_name ${{env.builddir}}/bin/3c \
            --extra-3c-arg=-alltypes \
            --expand_macros_before_conversion \
            --project_path .

      - name: Build converted yacr2 (filter bounds inference errors) (defer failure)
        run: |
          cd ${{env.benchmark_conv_dir}}/expand_macros_alltypes/ptrdist-1.1/yacr2
          if [ -e "out.checked" ]; then cp -r out.checked/* . && rm -r out.checked; fi
          make -j $(nproc) -l $(nproc) --output-sync CC="${{env.builddir}}/bin/clang" -k LOCAL_CFLAGS="-w -ferror-limit=0 -D_ISOC99_SOURCE" 2>&1 | ${{github.workspace}}/depsfolder/actions/filter-bounds-inference-errors.py || echo yacr2 >>${{env.benchmark_conv_dir}}/expand_macros_alltypes/ptrdist-1.1/failed-components-list.txt

      - name: Check for deferred post-conversion build failures
        run: |
          if [ -e ${{env.benchmark_conv_dir}}/expand_macros_alltypes/ptrdist-1.1/failed-components-list.txt ]; then
              echo 'Failed components (see previous post-conversion build steps):'
              cat ${{env.benchmark_conv_dir}}/expand_macros_alltypes/ptrdist-1.1/failed-components-list.txt
              exit 1
          fi

  test_libarchive_no_expand_macros_no_alltypes:
    name: Test LibArchive (not macro-expanded, no -alltypes)
    needs: build_3c
    runs-on: self-hosted
    steps:
      - name: Build LibArchive
        run: |
          mkdir -p ${{env.benchmark_conv_dir}}/no_expand_macros_no_alltypes
          cd ${{env.benchmark_conv_dir}}/no_expand_macros_no_alltypes
          tar -xvzf ${{env.benchmark_tar_dir}}/libarchive-3.4.3.tar.gz
          cd libarchive-3.4.3
          cd build
          cmake -DCMAKE_C_COMPILER=${{env.builddir}}/bin/clang -G Ninja -DCMAKE_C_FLAGS="-w -ferror-limit=0 -D_GNU_SOURCE" ..
          bear ninja -l $(nproc) archive

      - name: Convert LibArchive
        run: |
          cd ${{env.benchmark_conv_dir}}/no_expand_macros_no_alltypes/libarchive-3.4.3
          ${{env.port_tools}}/convert_project.py \
            --skip '/.*/(test|test_utils|tar|cat|cpio|examples|contrib|libarchive_fe)/.*' \
            --prog_name ${{env.builddir}}/bin/3c \
            --project_path . \
            --build_dir build

      - name: Build converted LibArchive
        run: |
          cd ${{env.benchmark_conv_dir}}/no_expand_macros_no_alltypes/libarchive-3.4.3
          if [ -e "out.checked" ]; then cp -r out.checked/* . && rm -r out.checked; fi
          cd build
          ninja -l $(nproc) -k 0 archive

  test_libarchive_no_expand_macros_alltypes:
    name: Test LibArchive (not macro-expanded, -alltypes)
    needs: build_3c
    runs-on: self-hosted
    steps:
      - name: Build LibArchive
        run: |
          mkdir -p ${{env.benchmark_conv_dir}}/no_expand_macros_alltypes
          cd ${{env.benchmark_conv_dir}}/no_expand_macros_alltypes
          tar -xvzf ${{env.benchmark_tar_dir}}/libarchive-3.4.3.tar.gz
          cd libarchive-3.4.3
          cd build
          cmake -DCMAKE_C_COMPILER=${{env.builddir}}/bin/clang -G Ninja -DCMAKE_C_FLAGS="-w -ferror-limit=0 -D_GNU_SOURCE" ..
          bear ninja -l $(nproc) archive

      - name: Convert LibArchive
        run: |
          cd ${{env.benchmark_conv_dir}}/no_expand_macros_alltypes/libarchive-3.4.3
          ${{env.port_tools}}/convert_project.py \
            --skip '/.*/(test|test_utils|tar|cat|cpio|examples|contrib|libarchive_fe)/.*' \
            --prog_name ${{env.builddir}}/bin/3c \
            --extra-3c-arg=-alltypes \
            --project_path . \
            --build_dir build

      - name: Build converted LibArchive (filter bounds inference errors)
        run: |
          cd ${{env.benchmark_conv_dir}}/no_expand_macros_alltypes/libarchive-3.4.3
          if [ -e "out.checked" ]; then cp -r out.checked/* . && rm -r out.checked; fi
          cd build
          ninja -l $(nproc) -k 0 archive 2>&1 | ${{github.workspace}}/depsfolder/actions/filter-bounds-inference-errors.py

  test_libarchive_expand_macros_no_alltypes:
    name: Test LibArchive (macro-expanded, no -alltypes)
    needs: build_3c
    runs-on: self-hosted
    steps:
      - name: Build LibArchive
        run: |
          mkdir -p ${{env.benchmark_conv_dir}}/expand_macros_no_alltypes
          cd ${{env.benchmark_conv_dir}}/expand_macros_no_alltypes
          tar -xvzf ${{env.benchmark_tar_dir}}/libarchive-3.4.3.tar.gz
          cd libarchive-3.4.3
          cd build
          cmake -DCMAKE_C_COMPILER=${{env.builddir}}/bin/clang -G Ninja -DCMAKE_C_FLAGS="-w -ferror-limit=0 -D_GNU_SOURCE" ..
          bear ninja -l $(nproc) archive

      - name: Convert LibArchive
        run: |
          cd ${{env.benchmark_conv_dir}}/expand_macros_no_alltypes/libarchive-3.4.3
          ${{env.port_tools}}/convert_project.py \
            --skip '/.*/(test|test_utils|tar|cat|cpio|examples|contrib|libarchive_fe)/.*' \
            --prog_name ${{env.builddir}}/bin/3c \
            --expand_macros_before_conversion \
            --project_path . \
            --build_dir build

      - name: Build converted LibArchive
        run: |
          cd ${{env.benchmark_conv_dir}}/expand_macros_no_alltypes/libarchive-3.4.3
          if [ -e "out.checked" ]; then cp -r out.checked/* . && rm -r out.checked; fi
          cd build
          ninja -l $(nproc) -k 0 archive

  test_libarchive_expand_macros_alltypes:
    name: Test LibArchive (macro-expanded, -alltypes)
    needs: build_3c
    runs-on: self-hosted
    steps:
      - name: Build LibArchive
        run: |
          mkdir -p ${{env.benchmark_conv_dir}}/expand_macros_alltypes
          cd ${{env.benchmark_conv_dir}}/expand_macros_alltypes
          tar -xvzf ${{env.benchmark_tar_dir}}/libarchive-3.4.3.tar.gz
          cd libarchive-3.4.3
          cd build
          cmake -DCMAKE_C_COMPILER=${{env.builddir}}/bin/clang -G Ninja -DCMAKE_C_FLAGS="-w -ferror-limit=0 -D_GNU_SOURCE" ..
          bear ninja -l $(nproc) archive

      - name: Convert LibArchive
        run: |
          cd ${{env.benchmark_conv_dir}}/expand_macros_alltypes/libarchive-3.4.3
          ${{env.port_tools}}/convert_project.py \
            --skip '/.*/(test|test_utils|tar|cat|cpio|examples|contrib|libarchive_fe)/.*' \
            --prog_name ${{env.builddir}}/bin/3c \
            --extra-3c-arg=-alltypes \
            --expand_macros_before_conversion \
            --project_path . \
            --build_dir build

      - name: Build converted LibArchive (filter bounds inference errors)
        run: |
          cd ${{env.benchmark_conv_dir}}/expand_macros_alltypes/libarchive-3.4.3
          if [ -e "out.checked" ]; then cp -r out.checked/* . && rm -r out.checked; fi
          cd build
          ninja -l $(nproc) -k 0 archive 2>&1 | ${{github.workspace}}/depsfolder/actions/filter-bounds-inference-errors.py

  test_lua_no_expand_macros_no_alltypes:
    name: Test Lua (not macro-expanded, no -alltypes)
    needs: build_3c
    runs-on: self-hosted
    steps:
      - name: Build Lua
        run: |
          mkdir -p ${{env.benchmark_conv_dir}}/no_expand_macros_no_alltypes
          cd ${{env.benchmark_conv_dir}}/no_expand_macros_no_alltypes
          tar -xvzf ${{env.benchmark_tar_dir}}/lua-5.4.1.tar.gz
          cd lua-5.4.1
          bear make -j $(nproc) -l $(nproc) --output-sync CC="${{env.builddir}}/bin/clang" CFLAGS="-w -ferror-limit=0" linux
          ( cd src ; \
            ${{env.builddir}}/bin/clang-rename -pl -i \
              --qualified-name=main \
              --new-name=luac_main \
              luac.c )

      - name: Convert Lua
        run: |
          cd ${{env.benchmark_conv_dir}}/no_expand_macros_no_alltypes/lua-5.4.1
          ${{env.port_tools}}/convert_project.py \
            --prog_name ${{env.builddir}}/bin/3c \
            --project_path .

      - name: Build converted Lua
        run: |
          cd ${{env.benchmark_conv_dir}}/no_expand_macros_no_alltypes/lua-5.4.1
          if [ -e "out.checked" ]; then cp -r out.checked/* . && rm -r out.checked; fi
          sed -i "s/luac_main/main/" src/luac.c
          make -j $(nproc) -l $(nproc) --output-sync CC="${{env.builddir}}/bin/clang" -k CFLAGS="-w -ferror-limit=0" linux

  test_lua_no_expand_macros_alltypes:
    name: Test Lua (not macro-expanded, -alltypes)
    needs: build_3c
    runs-on: self-hosted
    steps:
      - name: Build Lua
        run: |
          mkdir -p ${{env.benchmark_conv_dir}}/no_expand_macros_alltypes
          cd ${{env.benchmark_conv_dir}}/no_expand_macros_alltypes
          tar -xvzf ${{env.benchmark_tar_dir}}/lua-5.4.1.tar.gz
          cd lua-5.4.1
          bear make -j $(nproc) -l $(nproc) --output-sync CC="${{env.builddir}}/bin/clang" CFLAGS="-w -ferror-limit=0" linux
          ( cd src ; \
            ${{env.builddir}}/bin/clang-rename -pl -i \
              --qualified-name=main \
              --new-name=luac_main \
              luac.c )

      - name: Convert Lua
        run: |
          cd ${{env.benchmark_conv_dir}}/no_expand_macros_alltypes/lua-5.4.1
          ${{env.port_tools}}/convert_project.py \
            --prog_name ${{env.builddir}}/bin/3c \
            --extra-3c-arg=-alltypes \
            --project_path .

      - name: Build converted Lua (filter bounds inference errors)
        run: |
          cd ${{env.benchmark_conv_dir}}/no_expand_macros_alltypes/lua-5.4.1
          if [ -e "out.checked" ]; then cp -r out.checked/* . && rm -r out.checked; fi
          sed -i "s/luac_main/main/" src/luac.c
          make -j $(nproc) -l $(nproc) --output-sync CC="${{env.builddir}}/bin/clang" -k CFLAGS="-w -ferror-limit=0" linux 2>&1 | ${{github.workspace}}/depsfolder/actions/filter-bounds-inference-errors.py

  test_lua_expand_macros_no_alltypes:
    name: Test Lua (macro-expanded, no -alltypes)
    needs: build_3c
    runs-on: self-hosted
    steps:
      - name: Build Lua
        run: |
          mkdir -p ${{env.benchmark_conv_dir}}/expand_macros_no_alltypes
          cd ${{env.benchmark_conv_dir}}/expand_macros_no_alltypes
          tar -xvzf ${{env.benchmark_tar_dir}}/lua-5.4.1.tar.gz
          cd lua-5.4.1
          bear make -j $(nproc) -l $(nproc) --output-sync CC="${{env.builddir}}/bin/clang" CFLAGS="-w -ferror-limit=0" linux
          ( cd src ; \
            ${{env.builddir}}/bin/clang-rename -pl -i \
              --qualified-name=main \
              --new-name=luac_main \
              luac.c )

      - name: Convert Lua
        run: |
          cd ${{env.benchmark_conv_dir}}/expand_macros_no_alltypes/lua-5.4.1
          ${{env.port_tools}}/convert_project.py \
            --prog_name ${{env.builddir}}/bin/3c \
            --expand_macros_before_conversion \
            --project_path .

      - name: Build converted Lua
        run: |
          cd ${{env.benchmark_conv_dir}}/expand_macros_no_alltypes/lua-5.4.1
          if [ -e "out.checked" ]; then cp -r out.checked/* . && rm -r out.checked; fi
          sed -i "s/luac_main/main/" src/luac.c
          make -j $(nproc) -l $(nproc) --output-sync CC="${{env.builddir}}/bin/clang" -k CFLAGS="-w -ferror-limit=0" linux

  test_lua_expand_macros_alltypes:
    name: Test Lua (macro-expanded, -alltypes)
    needs: build_3c
    runs-on: self-hosted
    steps:
      - name: Build Lua
        run: |
          mkdir -p ${{env.benchmark_conv_dir}}/expand_macros_alltypes
          cd ${{env.benchmark_conv_dir}}/expand_macros_alltypes
          tar -xvzf ${{env.benchmark_tar_dir}}/lua-5.4.1.tar.gz
          cd lua-5.4.1
          bear make -j $(nproc) -l $(nproc) --output-sync CC="${{env.builddir}}/bin/clang" CFLAGS="-w -ferror-limit=0" linux
          ( cd src ; \
            ${{env.builddir}}/bin/clang-rename -pl -i \
              --qualified-name=main \
              --new-name=luac_main \
              luac.c )

      - name: Convert Lua
        run: |
          cd ${{env.benchmark_conv_dir}}/expand_macros_alltypes/lua-5.4.1
          ${{env.port_tools}}/convert_project.py \
            --prog_name ${{env.builddir}}/bin/3c \
            --extra-3c-arg=-alltypes \
            --expand_macros_before_conversion \
            --project_path .

      - name: Build converted Lua (filter bounds inference errors)
        run: |
          cd ${{env.benchmark_conv_dir}}/expand_macros_alltypes/lua-5.4.1
          if [ -e "out.checked" ]; then cp -r out.checked/* . && rm -r out.checked; fi
          sed -i "s/luac_main/main/" src/luac.c
          make -j $(nproc) -l $(nproc) --output-sync CC="${{env.builddir}}/bin/clang" -k CFLAGS="-w -ferror-limit=0" linux 2>&1 | ${{github.workspace}}/depsfolder/actions/filter-bounds-inference-errors.py

  test_libtiff_no_expand_macros_no_alltypes:
    name: Test LibTiff (not macro-expanded, no -alltypes)
    needs: build_3c
    runs-on: self-hosted
    steps:
      - name: Build LibTiff
        run: |
          mkdir -p ${{env.benchmark_conv_dir}}/no_expand_macros_no_alltypes
          cd ${{env.benchmark_conv_dir}}/no_expand_macros_no_alltypes
          tar -xvzf ${{env.benchmark_tar_dir}}/tiff-4.1.0.tar.gz
          for i in ${{env.benchmark_tar_dir}}/tiff-4.1.0_patches/*; do patch -s -p0 < $i; done
          cd tiff-4.1.0
          cmake -DCMAKE_C_COMPILER=${{env.builddir}}/bin/clang -G Ninja -DCMAKE_C_FLAGS="-w -ferror-limit=0" .
          bear ninja -l $(nproc) tiff
          ( cd tools ; \
            for i in *.c ; do \
              ${{env.builddir}}/bin/clang-rename -pl -i \
                --qualified-name=main \
                --new-name=$(basename -s .c $i)_main $i ; \
            done)

      - name: Convert LibTiff
        run: |
          cd ${{env.benchmark_conv_dir}}/no_expand_macros_no_alltypes/tiff-4.1.0
          ${{env.port_tools}}/convert_project.py \
            --skip '/.*/tif_stream.cxx' \
            --skip '.*/test/.*\.c' \
            --skip '.*/contrib/.*\.c' \
            --prog_name ${{env.builddir}}/bin/3c \
            --project_path .

      - name: Build converted LibTiff
        run: |
          cd ${{env.benchmark_conv_dir}}/no_expand_macros_no_alltypes/tiff-4.1.0
          if [ -e "out.checked" ]; then cp -r out.checked/* . && rm -r out.checked; fi
          ninja -l $(nproc) -k 0 tiff

  test_libtiff_no_expand_macros_alltypes:
    name: Test LibTiff (not macro-expanded, -alltypes)
    needs: build_3c
    runs-on: self-hosted
    steps:
      - name: Build LibTiff
        run: |
          mkdir -p ${{env.benchmark_conv_dir}}/no_expand_macros_alltypes
          cd ${{env.benchmark_conv_dir}}/no_expand_macros_alltypes
          tar -xvzf ${{env.benchmark_tar_dir}}/tiff-4.1.0.tar.gz
          for i in ${{env.benchmark_tar_dir}}/tiff-4.1.0_patches/*; do patch -s -p0 < $i; done
          cd tiff-4.1.0
          cmake -DCMAKE_C_COMPILER=${{env.builddir}}/bin/clang -G Ninja -DCMAKE_C_FLAGS="-w -ferror-limit=0" .
          bear ninja -l $(nproc) tiff
          ( cd tools ; \
            for i in *.c ; do \
              ${{env.builddir}}/bin/clang-rename -pl -i \
                --qualified-name=main \
                --new-name=$(basename -s .c $i)_main $i ; \
            done)

      - name: Convert LibTiff
        run: |
          cd ${{env.benchmark_conv_dir}}/no_expand_macros_alltypes/tiff-4.1.0
          ${{env.port_tools}}/convert_project.py \
            --skip '/.*/tif_stream.cxx' \
            --skip '.*/test/.*\.c' \
            --skip '.*/contrib/.*\.c' \
            --prog_name ${{env.builddir}}/bin/3c \
            --extra-3c-arg=-alltypes \
            --project_path .

      - name: Build converted LibTiff (filter bounds inference errors)
        run: |
          cd ${{env.benchmark_conv_dir}}/no_expand_macros_alltypes/tiff-4.1.0
          if [ -e "out.checked" ]; then cp -r out.checked/* . && rm -r out.checked; fi
          ninja -l $(nproc) -k 0 tiff 2>&1 | ${{github.workspace}}/depsfolder/actions/filter-bounds-inference-errors.py

  test_libtiff_expand_macros_no_alltypes:
    name: Test LibTiff (macro-expanded, no -alltypes)
    needs: build_3c
    runs-on: self-hosted
    steps:
      - name: Build LibTiff
        run: |
          mkdir -p ${{env.benchmark_conv_dir}}/expand_macros_no_alltypes
          cd ${{env.benchmark_conv_dir}}/expand_macros_no_alltypes
          tar -xvzf ${{env.benchmark_tar_dir}}/tiff-4.1.0.tar.gz
          for i in ${{env.benchmark_tar_dir}}/tiff-4.1.0_patches/*; do patch -s -p0 < $i; done
          cd tiff-4.1.0
          cmake -DCMAKE_C_COMPILER=${{env.builddir}}/bin/clang -G Ninja -DCMAKE_C_FLAGS="-w -ferror-limit=0" .
          bear ninja -l $(nproc) tiff
          ( cd tools ; \
            for i in *.c ; do \
              ${{env.builddir}}/bin/clang-rename -pl -i \
                --qualified-name=main \
                --new-name=$(basename -s .c $i)_main $i ; \
            done)

      - name: Convert LibTiff
        run: |
          cd ${{env.benchmark_conv_dir}}/expand_macros_no_alltypes/tiff-4.1.0
          ${{env.port_tools}}/convert_project.py \
            --skip '/.*/tif_stream.cxx' \
            --skip '.*/test/.*\.c' \
            --skip '.*/contrib/.*\.c' \
            --prog_name ${{env.builddir}}/bin/3c \
            --expand_macros_before_conversion \
            --project_path .

      - name: Build converted LibTiff
        run: |
          cd ${{env.benchmark_conv_dir}}/expand_macros_no_alltypes/tiff-4.1.0
          if [ -e "out.checked" ]; then cp -r out.checked/* . && rm -r out.checked; fi
          ninja -l $(nproc) -k 0 tiff

  test_libtiff_expand_macros_alltypes:
    name: Test LibTiff (macro-expanded, -alltypes)
    needs: build_3c
    runs-on: self-hosted
    steps:
      - name: Build LibTiff
        run: |
          mkdir -p ${{env.benchmark_conv_dir}}/expand_macros_alltypes
          cd ${{env.benchmark_conv_dir}}/expand_macros_alltypes
          tar -xvzf ${{env.benchmark_tar_dir}}/tiff-4.1.0.tar.gz
          for i in ${{env.benchmark_tar_dir}}/tiff-4.1.0_patches/*; do patch -s -p0 < $i; done
          cd tiff-4.1.0
          cmake -DCMAKE_C_COMPILER=${{env.builddir}}/bin/clang -G Ninja -DCMAKE_C_FLAGS="-w -ferror-limit=0" .
          bear ninja -l $(nproc) tiff
          ( cd tools ; \
            for i in *.c ; do \
              ${{env.builddir}}/bin/clang-rename -pl -i \
                --qualified-name=main \
                --new-name=$(basename -s .c $i)_main $i ; \
            done)

      - name: Convert LibTiff
        run: |
          cd ${{env.benchmark_conv_dir}}/expand_macros_alltypes/tiff-4.1.0
          ${{env.port_tools}}/convert_project.py \
            --skip '/.*/tif_stream.cxx' \
            --skip '.*/test/.*\.c' \
            --skip '.*/contrib/.*\.c' \
            --prog_name ${{env.builddir}}/bin/3c \
            --extra-3c-arg=-alltypes \
            --expand_macros_before_conversion \
            --project_path .

      - name: Build converted LibTiff (filter bounds inference errors)
        run: |
          cd ${{env.benchmark_conv_dir}}/expand_macros_alltypes/tiff-4.1.0
          if [ -e "out.checked" ]; then cp -r out.checked/* . && rm -r out.checked; fi
          ninja -l $(nproc) -k 0 tiff 2>&1 | ${{github.workspace}}/depsfolder/actions/filter-bounds-inference-errors.py

  test_zlib_no_expand_macros_no_alltypes:
    name: Test ZLib (not macro-expanded, no -alltypes)
    needs: build_3c
    runs-on: self-hosted
    steps:
      - name: Build ZLib
        run: |
          mkdir -p ${{env.benchmark_conv_dir}}/no_expand_macros_no_alltypes
          cd ${{env.benchmark_conv_dir}}/no_expand_macros_no_alltypes
          tar -xvzf ${{env.benchmark_tar_dir}}/zlib-1.2.11.tar.gz
          cd zlib-1.2.11
          mkdir build
          cd build
          cmake -DCMAKE_C_COMPILER=${{env.builddir}}/bin/clang -G Ninja -DCMAKE_C_FLAGS="-w -ferror-limit=0" ..
          bear ninja -l $(nproc) zlib

      - name: Convert ZLib
        run: |
          cd ${{env.benchmark_conv_dir}}/no_expand_macros_no_alltypes/zlib-1.2.11
          ${{env.port_tools}}/convert_project.py \
            --skip '/.*/test/.*' \
            --prog_name ${{env.builddir}}/bin/3c \
            --project_path . \
            --build_dir build

      - name: Build converted ZLib
        run: |
          cd ${{env.benchmark_conv_dir}}/no_expand_macros_no_alltypes/zlib-1.2.11
          if [ -e "out.checked" ]; then cp -r out.checked/* . && rm -r out.checked; fi
          cd build
          ninja -l $(nproc) -k 0 zlib

  test_zlib_no_expand_macros_alltypes:
    name: Test ZLib (not macro-expanded, -alltypes)
    needs: build_3c
    runs-on: self-hosted
    steps:
      - name: Build ZLib
        run: |
          mkdir -p ${{env.benchmark_conv_dir}}/no_expand_macros_alltypes
          cd ${{env.benchmark_conv_dir}}/no_expand_macros_alltypes
          tar -xvzf ${{env.benchmark_tar_dir}}/zlib-1.2.11.tar.gz
          cd zlib-1.2.11
          mkdir build
          cd build
          cmake -DCMAKE_C_COMPILER=${{env.builddir}}/bin/clang -G Ninja -DCMAKE_C_FLAGS="-w -ferror-limit=0" ..
          bear ninja -l $(nproc) zlib

      - name: Convert ZLib
        run: |
          cd ${{env.benchmark_conv_dir}}/no_expand_macros_alltypes/zlib-1.2.11
          ${{env.port_tools}}/convert_project.py \
            --skip '/.*/test/.*' \
            --prog_name ${{env.builddir}}/bin/3c \
            --extra-3c-arg=-alltypes \
            --project_path . \
            --build_dir build

      - name: Build converted ZLib (filter bounds inference errors)
        run: |
          cd ${{env.benchmark_conv_dir}}/no_expand_macros_alltypes/zlib-1.2.11
          if [ -e "out.checked" ]; then cp -r out.checked/* . && rm -r out.checked; fi
          cd build
          ninja -l $(nproc) -k 0 zlib 2>&1 | ${{github.workspace}}/depsfolder/actions/filter-bounds-inference-errors.py

  test_zlib_expand_macros_no_alltypes:
    name: Test ZLib (macro-expanded, no -alltypes)
    needs: build_3c
    runs-on: self-hosted
    steps:
      - name: Build ZLib
        run: |
          mkdir -p ${{env.benchmark_conv_dir}}/expand_macros_no_alltypes
          cd ${{env.benchmark_conv_dir}}/expand_macros_no_alltypes
          tar -xvzf ${{env.benchmark_tar_dir}}/zlib-1.2.11.tar.gz
          cd zlib-1.2.11
          mkdir build
          cd build
          cmake -DCMAKE_C_COMPILER=${{env.builddir}}/bin/clang -G Ninja -DCMAKE_C_FLAGS="-w -ferror-limit=0" ..
          bear ninja -l $(nproc) zlib

      - name: Convert ZLib
        run: |
          cd ${{env.benchmark_conv_dir}}/expand_macros_no_alltypes/zlib-1.2.11
          ${{env.port_tools}}/convert_project.py \
            --skip '/.*/test/.*' \
            --prog_name ${{env.builddir}}/bin/3c \
            --expand_macros_before_conversion \
            --project_path . \
            --build_dir build

      - name: Build converted ZLib
        run: |
          cd ${{env.benchmark_conv_dir}}/expand_macros_no_alltypes/zlib-1.2.11
          if [ -e "out.checked" ]; then cp -r out.checked/* . && rm -r out.checked; fi
          cd build
          ninja -l $(nproc) -k 0 zlib

  test_zlib_expand_macros_alltypes:
    name: Test ZLib (macro-expanded, -alltypes)
    needs: build_3c
    runs-on: self-hosted
    steps:
      - name: Build ZLib
        run: |
          mkdir -p ${{env.benchmark_conv_dir}}/expand_macros_alltypes
          cd ${{env.benchmark_conv_dir}}/expand_macros_alltypes
          tar -xvzf ${{env.benchmark_tar_dir}}/zlib-1.2.11.tar.gz
          cd zlib-1.2.11
          mkdir build
          cd build
          cmake -DCMAKE_C_COMPILER=${{env.builddir}}/bin/clang -G Ninja -DCMAKE_C_FLAGS="-w -ferror-limit=0" ..
          bear ninja -l $(nproc) zlib

      - name: Convert ZLib
        run: |
          cd ${{env.benchmark_conv_dir}}/expand_macros_alltypes/zlib-1.2.11
          ${{env.port_tools}}/convert_project.py \
            --skip '/.*/test/.*' \
            --prog_name ${{env.builddir}}/bin/3c \
            --extra-3c-arg=-alltypes \
            --expand_macros_before_conversion \
            --project_path . \
            --build_dir build

      - name: Build converted ZLib (filter bounds inference errors)
        run: |
          cd ${{env.benchmark_conv_dir}}/expand_macros_alltypes/zlib-1.2.11
          if [ -e "out.checked" ]; then cp -r out.checked/* . && rm -r out.checked; fi
          cd build
          ninja -l $(nproc) -k 0 zlib 2>&1 | ${{github.workspace}}/depsfolder/actions/filter-bounds-inference-errors.py

  test_icecast_no_expand_macros_no_alltypes:
    name: Test Icecast (not macro-expanded, no -alltypes)
    needs: build_3c
    runs-on: self-hosted
    steps:
      - name: Build Icecast
        run: |
          mkdir -p ${{env.benchmark_conv_dir}}/no_expand_macros_no_alltypes
          cd ${{env.benchmark_conv_dir}}/no_expand_macros_no_alltypes
          tar -xvzf ${{env.benchmark_tar_dir}}/icecast-2.4.4.tar.gz
          cd icecast-2.4.4
          sed -i '/_GNU_SOURCE/d' configure
          CC="${{env.builddir}}/bin/clang" CFLAGS="-w -ferror-limit=0" ./configure
          bear make -j $(nproc) -l $(nproc) --output-sync

      - name: Convert Icecast
        run: |
          cd ${{env.benchmark_conv_dir}}/no_expand_macros_no_alltypes/icecast-2.4.4
          ${{env.port_tools}}/convert_project.py \
            --prog_name ${{env.builddir}}/bin/3c \
            --project_path .

      - name: Build converted Icecast
        run: |
          cd ${{env.benchmark_conv_dir}}/no_expand_macros_no_alltypes/icecast-2.4.4
          if [ -e "out.checked" ]; then cp -r out.checked/* . && rm -r out.checked; fi
          make -j $(nproc) -l $(nproc) --output-sync -k

  test_icecast_no_expand_macros_alltypes:
    name: Test Icecast (not macro-expanded, -alltypes)
    needs: build_3c
    runs-on: self-hosted
    steps:
      - name: Build Icecast
        run: |
          mkdir -p ${{env.benchmark_conv_dir}}/no_expand_macros_alltypes
          cd ${{env.benchmark_conv_dir}}/no_expand_macros_alltypes
          tar -xvzf ${{env.benchmark_tar_dir}}/icecast-2.4.4.tar.gz
          cd icecast-2.4.4
          sed -i '/_GNU_SOURCE/d' configure
          CC="${{env.builddir}}/bin/clang" CFLAGS="-w -ferror-limit=0" ./configure
          bear make -j $(nproc) -l $(nproc) --output-sync

      - name: Convert Icecast
        run: |
          cd ${{env.benchmark_conv_dir}}/no_expand_macros_alltypes/icecast-2.4.4
          ${{env.port_tools}}/convert_project.py \
            --prog_name ${{env.builddir}}/bin/3c \
            --extra-3c-arg=-alltypes \
            --project_path .

      - name: Build converted Icecast (filter bounds inference errors)
        run: |
          cd ${{env.benchmark_conv_dir}}/no_expand_macros_alltypes/icecast-2.4.4
          if [ -e "out.checked" ]; then cp -r out.checked/* . && rm -r out.checked; fi
          make -j $(nproc) -l $(nproc) --output-sync -k 2>&1 | ${{github.workspace}}/depsfolder/actions/filter-bounds-inference-errors.py

  test_icecast_expand_macros_no_alltypes:
    name: Test Icecast (macro-expanded, no -alltypes)
    needs: build_3c
    runs-on: self-hosted
    steps:
      - name: Build Icecast
        run: |
          mkdir -p ${{env.benchmark_conv_dir}}/expand_macros_no_alltypes
          cd ${{env.benchmark_conv_dir}}/expand_macros_no_alltypes
          tar -xvzf ${{env.benchmark_tar_dir}}/icecast-2.4.4.tar.gz
          cd icecast-2.4.4
          sed -i '/_GNU_SOURCE/d' configure
          CC="${{env.builddir}}/bin/clang" CFLAGS="-w -ferror-limit=0" ./configure
          bear make -j $(nproc) -l $(nproc) --output-sync

      - name: Convert Icecast
        run: |
          cd ${{env.benchmark_conv_dir}}/expand_macros_no_alltypes/icecast-2.4.4
          ${{env.port_tools}}/convert_project.py \
            --prog_name ${{env.builddir}}/bin/3c \
            --expand_macros_before_conversion \
            --project_path .

      - name: Build converted Icecast
        run: |
          cd ${{env.benchmark_conv_dir}}/expand_macros_no_alltypes/icecast-2.4.4
          if [ -e "out.checked" ]; then cp -r out.checked/* . && rm -r out.checked; fi
          make -j $(nproc) -l $(nproc) --output-sync -k

  test_icecast_expand_macros_alltypes:
    name: Test Icecast (macro-expanded, -alltypes)
    needs: build_3c
    runs-on: self-hosted
    steps:
      - name: Build Icecast
        run: |
          mkdir -p ${{env.benchmark_conv_dir}}/expand_macros_alltypes
          cd ${{env.benchmark_conv_dir}}/expand_macros_alltypes
          tar -xvzf ${{env.benchmark_tar_dir}}/icecast-2.4.4.tar.gz
          cd icecast-2.4.4
          sed -i '/_GNU_SOURCE/d' configure
          CC="${{env.builddir}}/bin/clang" CFLAGS="-w -ferror-limit=0" ./configure
          bear make -j $(nproc) -l $(nproc) --output-sync

      - name: Convert Icecast
        run: |
          cd ${{env.benchmark_conv_dir}}/expand_macros_alltypes/icecast-2.4.4
          ${{env.port_tools}}/convert_project.py \
            --prog_name ${{env.builddir}}/bin/3c \
            --extra-3c-arg=-alltypes \
            --expand_macros_before_conversion \
            --project_path .

      - name: Build converted Icecast (filter bounds inference errors)
        run: |
          cd ${{env.benchmark_conv_dir}}/expand_macros_alltypes/icecast-2.4.4
          if [ -e "out.checked" ]; then cp -r out.checked/* . && rm -r out.checked; fi
          make -j $(nproc) -l $(nproc) --output-sync -k 2>&1 | ${{github.workspace}}/depsfolder/actions/filter-bounds-inference-errors.py

  test_thttpd_no_expand_macros_no_alltypes:
    name: Test Thttpd (not macro-expanded, no -alltypes)
    needs: build_3c
    runs-on: self-hosted
    steps:
      - name: Build Thttpd
        run: |
          mkdir -p ${{env.benchmark_conv_dir}}/no_expand_macros_no_alltypes
          cd ${{env.benchmark_conv_dir}}/no_expand_macros_no_alltypes
          tar -xvzf ${{env.benchmark_tar_dir}}/thttpd-2.29.tar.gz
          for i in ${{env.benchmark_tar_dir}}/thttpd-2.29_patches/*; do patch -s -p0 < $i; done
          cd thttpd-2.29
          CC="${{env.builddir}}/bin/clang" ./configure
          chmod -R 777 *
          bear make CC="${{env.builddir}}/bin/clang -w -ferror-limit=0"

      - name: Convert Thttpd
        run: |
          cd ${{env.benchmark_conv_dir}}/no_expand_macros_no_alltypes/thttpd-2.29
          ${{env.port_tools}}/convert_project.py \
            --prog_name ${{env.builddir}}/bin/3c \
            --project_path .

      - name: Build converted Thttpd
        run: |
          cd ${{env.benchmark_conv_dir}}/no_expand_macros_no_alltypes/thttpd-2.29
          if [ -e "out.checked" ]; then cp -r out.checked/* . && rm -r out.checked; fi
          make CC="${{env.builddir}}/bin/clang -w -ferror-limit=0" -k

  test_thttpd_no_expand_macros_alltypes:
    name: Test Thttpd (not macro-expanded, -alltypes)
    needs: build_3c
    runs-on: self-hosted
    steps:
      - name: Build Thttpd
        run: |
          mkdir -p ${{env.benchmark_conv_dir}}/no_expand_macros_alltypes
          cd ${{env.benchmark_conv_dir}}/no_expand_macros_alltypes
          tar -xvzf ${{env.benchmark_tar_dir}}/thttpd-2.29.tar.gz
          for i in ${{env.benchmark_tar_dir}}/thttpd-2.29_patches/*; do patch -s -p0 < $i; done
          cd thttpd-2.29
          CC="${{env.builddir}}/bin/clang" ./configure
          chmod -R 777 *
          bear make CC="${{env.builddir}}/bin/clang -w -ferror-limit=0"

      - name: Convert Thttpd
        run: |
          cd ${{env.benchmark_conv_dir}}/no_expand_macros_alltypes/thttpd-2.29
          ${{env.port_tools}}/convert_project.py \
            --prog_name ${{env.builddir}}/bin/3c \
            --extra-3c-arg=-alltypes \
            --project_path .

      - name: Build converted Thttpd (filter bounds inference errors)
        run: |
          cd ${{env.benchmark_conv_dir}}/no_expand_macros_alltypes/thttpd-2.29
          if [ -e "out.checked" ]; then cp -r out.checked/* . && rm -r out.checked; fi
          make CC="${{env.builddir}}/bin/clang -w -ferror-limit=0" -k 2>&1 | ${{github.workspace}}/depsfolder/actions/filter-bounds-inference-errors.py

  test_thttpd_expand_macros_no_alltypes:
    name: Test Thttpd (macro-expanded, no -alltypes)
    needs: build_3c
    runs-on: self-hosted
    steps:
      - name: Build Thttpd
        run: |
          mkdir -p ${{env.benchmark_conv_dir}}/expand_macros_no_alltypes
          cd ${{env.benchmark_conv_dir}}/expand_macros_no_alltypes
          tar -xvzf ${{env.benchmark_tar_dir}}/thttpd-2.29.tar.gz
          for i in ${{env.benchmark_tar_dir}}/thttpd-2.29_patches/*; do patch -s -p0 < $i; done
          cd thttpd-2.29
          CC="${{env.builddir}}/bin/clang" ./configure
          chmod -R 777 *
          bear make CC="${{env.builddir}}/bin/clang -w -ferror-limit=0"

      - name: Convert Thttpd
        run: |
          cd ${{env.benchmark_conv_dir}}/expand_macros_no_alltypes/thttpd-2.29
          ${{env.port_tools}}/convert_project.py \
            --prog_name ${{env.builddir}}/bin/3c \
            --expand_macros_before_conversion \
            --project_path .

      - name: Build converted Thttpd
        run: |
          cd ${{env.benchmark_conv_dir}}/expand_macros_no_alltypes/thttpd-2.29
          if [ -e "out.checked" ]; then cp -r out.checked/* . && rm -r out.checked; fi
          make CC="${{env.builddir}}/bin/clang -w -ferror-limit=0" -k

  test_thttpd_expand_macros_alltypes:
    name: Test Thttpd (macro-expanded, -alltypes)
    needs: build_3c
    runs-on: self-hosted
    steps:
      - name: Build Thttpd
        run: |
          mkdir -p ${{env.benchmark_conv_dir}}/expand_macros_alltypes
          cd ${{env.benchmark_conv_dir}}/expand_macros_alltypes
          tar -xvzf ${{env.benchmark_tar_dir}}/thttpd-2.29.tar.gz
          for i in ${{env.benchmark_tar_dir}}/thttpd-2.29_patches/*; do patch -s -p0 < $i; done
          cd thttpd-2.29
          CC="${{env.builddir}}/bin/clang" ./configure
          chmod -R 777 *
          bear make CC="${{env.builddir}}/bin/clang -w -ferror-limit=0"

      - name: Convert Thttpd
        run: |
          cd ${{env.benchmark_conv_dir}}/expand_macros_alltypes/thttpd-2.29
          ${{env.port_tools}}/convert_project.py \
            --prog_name ${{env.builddir}}/bin/3c \
            --extra-3c-arg=-alltypes \
            --expand_macros_before_conversion \
            --project_path .

      - name: Build converted Thttpd (filter bounds inference errors)
        run: |
          cd ${{env.benchmark_conv_dir}}/expand_macros_alltypes/thttpd-2.29
          if [ -e "out.checked" ]; then cp -r out.checked/* . && rm -r out.checked; fi
          make CC="${{env.builddir}}/bin/clang -w -ferror-limit=0" -k 2>&1 | ${{github.workspace}}/depsfolder/actions/filter-bounds-inference-errors.py
